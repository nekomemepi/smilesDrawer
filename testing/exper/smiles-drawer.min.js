(()=>{var ve=(M,e)=>()=>(e||M((e={exports:{}}).exports,e),e.exports);var Vt=ve((Ks,_i)=>{var Kr=class M{static clone(e){let t=Array.isArray(e)?Array():{};for(let r in e){let i=e[r];typeof i.clone=="function"?t[r]=i.clone():t[r]=typeof i=="object"?M.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let r=e.slice().sort(),i=t.slice().sort();for(var s=0;s<r.length;s++)if(r[s]!==i[s])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let r=0;r<e.length;r++)t(e[r])}static get(e,t,r){for(let i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}static contains(e,t){if(!t.property&&!t.func){for(let r=0;r<e.length;r++)if(e[r]==t.value)return!0}else if(t.func){for(let r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(let r=0;r<e.length;r++)if(e[r][t.property]==t.value)return!0;return!1}static intersection(e,t){let r=new Array;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r.push(e[i]);return r}static unique(e){let t={};return e.filter(function(r){return t[r]!==void 0?!1:t[r]=!0})}static count(e,t){let r=0;for(let i=0;i<e.length;i++)e[i]===t&&r++;return r}static toggle(e,t){let r=Array(),i=!1;for(let s=0;s<e.length;s++)e[s]!==t?r.push(e[s]):i=!0;return i||r.push(t),r}static remove(e,t){let r=Array();for(let i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}static removeUnique(e,t){let r=e.indexOf(t);return r>-1&&e.splice(r,1),e}static removeAll(e,t){return e.filter(function(r){return t.indexOf(r)===-1})}static merge(e,t){let r=new Array(e.length+t.length);for(let i=0;i<e.length;i++)r[i]=e[i];for(let i=0;i<t.length;i++)r[e.length+i]=t[i];return r}static containsAll(e,t){let r=0;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r++;return r===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(r,i){return{index:i,value:r.atomicNumber.split(".").map(Number)}});return t.sort(function(r,i){let s=Math.min(i.value.length,r.value.length),l=0;for(;l<s&&i.value[l]===r.value[l];)l++;return l===s?i.value.length-r.value.length:i.value[l]-r.value[l]}),t.map(function(r){return e[r.index]})}static deepCopy(e){let t=Array();for(let r=0;r<e.length;r++){let i=e[r];i instanceof Array?t[r]=M.deepCopy(i):t[r]=i}return t}};_i.exports=Kr});var Yt=ve((Js,Vi)=>{var Jr=class M{static round(e,t){return t=t||1,+(Math.round(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,r=0;for(var i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}static innerAngle(e){return M.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let r=M.polyCircumradius(e,t);return M.apothem(r,t)}static centralAngle(e){return M.toRad(360/e)}static toDeg(e){return e*M.degFactor}static toRad(e){return e*M.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),r=0,i=function(l,n=0){return t[l]===1?n:(n++,t[l]=1,i(e[l],n))};for(var s=0;s<e.length;s++){if(t[s]===1)continue;let l=i(s);r+=1-l%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};Vi.exports=Jr});var st=ve((Qs,Yi)=>{var Qr=class M{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):arguments.length==1?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new M(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}relativeClockwise(e,t){let r=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);return r>i?-1:r===i?0:1}rotate(e){let t=new M(0,0),r=Math.cos(e),i=Math.sin(e);return t.x=this.x*r-this.y*i,t.y=this.x*i+this.y*r,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;let s=this.x*i-this.y*r,l=this.x*r+this.y*i;return this.x=s+t.x,this.y=l+t.y,this}rotateTo(e,t,r=0){this.x+=.001,this.y-=.001;let i=M.subtract(this,t),s=M.subtract(e,t),l=M.angle(s,i);return this.rotateAround(l+r,t),this}rotateAwayFrom(e,t,r){this.rotateAround(r,t);let i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}getRotateAwayFromAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<s?r:-r}getRotateTowardsAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>s?r:-r}getRotateToAngle(e,t){let r=M.subtract(this,t),i=M.subtract(e,t),s=M.angle(i,r);return Number.isNaN(s)?0:s}isInPolygon(e){let t=!1;for(let r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return M.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,r){let i=this.whichSide(e,t),s=r.whichSide(e,t);return i<0&&s<0||i==0&&s==0||i>0&&s>0}static add(e,t){return new M(e.x+t.x,e.y+t.y)}static subtract(e,t){return new M(e.x-t.x,e.y-t.y)}static multiply(e,t){return new M(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new M(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new M((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let r=M.subtract(t,e);return[new M(-r.y,r.x),new M(r.y,-r.x)]}static units(e,t){let r=M.subtract(t,e);return[new M(-r.y,r.x).normalize(),new M(r.y,-r.x).normalize()]}static divide(e,t){return new M(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new M(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let r=M.dot(e,t);return Math.acos(r/(e.length()*t.length()))}static threePointangle(e,t,r){let i=M.subtract(t,e),s=M.subtract(r,t),l=e.distance(t),n=t.distance(r);return Math.acos(M.dot(i,s)/(l*n))}static scalarProjection(e,t){let r=t.normalized();return M.dot(e,r)}static averageDirection(e){let t=new M(0,0);for(var r=0;r<e.length;r++){let i=e[r];t.add(i)}return t.normalize()}};Yi.exports=Qr});var Pt=ve((ea,Gi)=>{var Ui=Yt(),Cr=Vt(),ar=st(),js=lr(),jr=class M{constructor(e,t=0,r=0){this.id=null,this.value=e,this.position=new ar(t||0,r||0),this.previousPosition=new ar(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let r=1;this.id===0&&this.value.bracket.hcount===0&&(r=0),this.value.bracket.hcount===1&&t===0&&(r=2),this.value.bracket.hcount===1&&t===1&&(this.neighbours.length<3?r=2:r=3),this.value.bracket.hcount===null&&t===0&&(r=1),this.value.bracket.hcount===null&&t===1&&(this.neighbours.length<3?r=1:r=2),this.neighbours.splice(r,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let e=new M(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new ar(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=Cr.clone(this.children),e.spanningTreeChildren=Cr.clone(this.spanningTreeChildren),e.edges=Cr.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let r=null;return e?r=ar.subtract(this.position,e):r=ar.subtract(this.position,this.previousPosition),t?Ui.toDeg(r.angle()):r.angle()}getTextDirection(e,t=!1){let r=this.getDrawnNeighbours(e),i=Array();if(e.length===1)return"right";for(let l=0;l<r.length;l++)i.push(this.getAngle(e[r[l]].position));let s=Ui.meanAngle(i);if(this.isTerminal()||t)Math.round(s*100)/100===1.57&&(s=s-.2),s=Math.round(Math.round(s/Math.PI)*Math.PI);else{let l=Math.PI/2;s=Math.round(Math.round(s/l)*l)}return s===2?"down":s===-2?"up":s===0||Object.is(s,-0)?"right":s===3||s===-3?"left":"down"}getNeighbours(e=null){if(e===null)return this.neighbours.slice();let t=Array();for(let r=0;r<this.neighbours.length;r++)this.neighbours[r]!==e&&t.push(this.neighbours[r]);return t}getDrawnNeighbours(e){let t=Array();for(let r=0;r<this.neighbours.length;r++)e[this.neighbours[r]].value.isDrawn&&t.push(this.neighbours[r]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=Array();for(let r=0;r<this.spanningTreeChildren.length;r++)(e===void 0||e!=this.spanningTreeChildren[r])&&t.push(this.spanningTreeChildren[r]);return this.parentVertexId!=null&&(e===void 0||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,r){let i=this.getNeighbours();for(let s=0;s<i.length;s++)if(Cr.contains(e[i[s]].value.rings,{value:t})&&i[s]!=r)return i[s];return null}};Gi.exports=jr});var ti=ve((ia,Zi)=>{var ta=Pt(),ra=Ut(),ei=class{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var r=0;r<e.members.length;r++){let i=e.members[r];for(let s=0;s<t.members.length;s++){let l=t.members[s];i===l&&this.addVertex(i)}}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(this.vertices.size>2)return!0;for(let t of this.vertices)if(e[t].value.rings.length>2)return!0;return!1}static isBridge(e,t,r,i){let s=null;for(let l=0;l<e.length;l++)if(s=e[l],s.firstRingId===r&&s.secondRingId===i||s.firstRingId===i&&s.secondRingId===r)return s.isBridge(t);return!1}static getNeighbours(e,t){let r=[];for(let i=0;i<e.length;i++){let s=e[i];s.firstRingId===t?r.push(s.secondRingId):s.secondRingId===t&&r.push(s.firstRingId)}return r}static getVertices(e,t,r){for(let i=0;i<e.length;i++){let s=e[i];if(s.firstRingId===t&&s.secondRingId===r||s.firstRingId===r&&s.secondRingId===t)return[...s.vertices]}}};Zi.exports=ei});var Ut=ve((sa,Ki)=>{var ri=Vt(),hs=st(),na=Pt(),us=ti(),ii=class M{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new hs(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new M(this.members);return e.id=this.id,e.insiders=ri.clone(this.insiders),e.neighbours=ri.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=ri.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let r=0;r<this.members.length;r++)t.push(e[this.members[r]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,r,i){r=r||r===0?r:this.members[0];let s=r,l=0;for(;s!=null&&l<100;){let n=s;t(n),s=e[s].getNextInRing(e,this.id,i),i=n,s==r&&(s=null),l++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let r=0;r<this.neighbours.length;r++){let i=us.getVertices(e,this.id,this.neighbours[r]);t[r]={n:i.length,neighbour:this.neighbours[r]}}return t.sort(function(r,i){return i.n-r.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),r=this.members.length;return t===3&&r===6||t===2&&r===5}getDoubleBondCount(e){let t=0;for(let r=0;r<this.members.length;r++){let i=e[this.members[r]].value;(i.bondType==="="||i.branchBond==="=")&&t++}return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}};Ki.exports=ii});var lr=ve((oa,Ji)=>{var gs=Vt(),aa=Pt(),la=Ut(),ni=class M{constructor(e,t="-"){this.idx=null,this.element=e.length===1?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,r=0,i=0){r===null&&(r=0),i===null&&(i=0);let s=r+e+i;this.attachedPseudoElements[s]?this.attachedPseudoElements[s].count+=1:this.attachedPseudoElements[s]={element:e,count:1,hydrogenCount:r,previousElement:t,charge:i},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(r){e[r]=t.attachedPseudoElements[r]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(e){gs.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let r=0;r<e.ringbonds.length;r++)for(let i=0;i<t.ringbonds.length;i++)if(e.ringbonds[r].id==t.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return M.atomicNumbers[this.element]}getMaxBonds(){return M.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}};Ji.exports=ni});var or=ve((ha,Qi)=>{var Gt=st(),si=class M{constructor(e=new Gt(0,0),t=new Gt(0,0),r=null,i=null,s=!1,l=!1){this.from=e,this.to=t,this.elementFrom=r,this.elementTo=i,this.chiralFrom=s,this.chiralTo=l}clone(){return new M(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return Gt.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),s=Math.cos(e),l=s*(r.x-t.x)-i*(r.y-t.y)+t.x,n=i*(r.x-t.x)-s*(r.y-t.y)+t.y;return this.setRightVector(l,n),this}shortenFrom(e){let t=Gt.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=Gt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=Gt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}};Qi.exports=si});var li=ve((ua,ji)=>{var ai=class M{constructor(e,t,r=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=M.bonds[e]}static get bonds(){return{".":0,"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};ji.exports=ai});var oi=ve((ga,en)=>{function fs(M){return M===1?"+":M===2?"2+":M===-1?"-":M===-2?"2-":""}en.exports={getChargeText:fs}});var nn=ve((pa,rn)=>{var Zt=Yt(),ze=st(),fa=or(),ca=Pt(),da=Ut(),{getChargeText:tn}=oi(),hi=class{constructor(e,t,r){typeof e=="string"||e instanceof String?this.canvas=document.getElementById(e):this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var l=0;l<e.length;l++){if(!e[l].value.isDrawn)continue;let g=e[l].position;t<g.x&&(t=g.x),r<g.y&&(r=g.y),i>g.x&&(i=g.x),s>g.y&&(s=g.y)}var n=this.opts.padding;t+=n,r+=n,i-=n,s-=n,this.drawingWidth=t-i,this.drawingHeight=r-s;var f=this.canvas.offsetWidth/this.drawingWidth,h=this.canvas.offsetHeight/this.drawingHeight,d=f<h?f:h;this.ctx.scale(d,d),this.offsetX=-i,this.offsetY=-s,f<h?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,r,i,s=!0,l=!1,n=""){let f=this.ctx,h=this.offsetX,d=this.offsetY;f.save(),f.lineWidth=1.5,f.beginPath(),f.arc(e+h,t+d,r,0,Zt.twoPI,!0),f.closePath(),l?(s?(f.fillStyle="#f00",f.fill()):(f.strokeStyle="#f00",f.stroke()),this.drawDebugText(e,t,n)):s?(f.fillStyle=i,f.fill()):(f.strokeStyle=i,f.stroke()),f.restore()}drawLine(e,t=!1,r=1){let i=this.ctx,s=this.offsetX,l=this.offsetY,n=e.clone().shorten(4),f=n.getLeftVector().clone(),h=n.getRightVector().clone();f.x+=s,f.y+=l,h.x+=s,h.y+=l,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),f=e.getLeftVector().clone(),h=e.getRightVector().clone(),f.x+=s,f.y+=l,h.x+=s,h.y+=l,i.save(),i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(f.x,f.y,h.x,h.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),r<1&&(i.globalAlpha=r),i.strokeStyle=d,i.stroke(),i.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,i=this.offsetX,s=this.offsetY,l=e.clone().shorten(5),n=l.getLeftVector().clone(),f=l.getRightVector().clone();n.x+=i,n.y+=s,f.x+=i,f.y+=s,n=e.getLeftVector().clone(),f=e.getRightVector().clone(),n.x+=i,n.y+=s,f.x+=i,f.y+=s,r.save();let h=ze.normals(n,f);h[0].normalize(),h[1].normalize();let d=e.getRightChiral(),g=n,c=f;d&&(g=f,c=n);let b=ze.add(g,ze.multiplyScalar(h[0],this.halfBondThickness)),x=ze.add(c,ze.multiplyScalar(h[0],1.5+this.halfBondThickness)),y=ze.add(c,ze.multiplyScalar(h[1],1.5+this.halfBondThickness)),L=ze.add(g,ze.multiplyScalar(h[1],this.halfBondThickness));r.beginPath(),r.moveTo(b.x,b.y),r.lineTo(x.x,x.y),r.lineTo(y.x,y.y),r.lineTo(L.x,L.y);let A=this.ctx.createRadialGradient(f.x,f.y,this.opts.bondLength,f.x,f.y,0);A.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),A.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=A,r.fill(),r.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,r=this.offsetX,i=this.offsetY,s=e.getLeftVector().clone(),l=e.getRightVector().clone();s.x+=r,s.y+=i,l.x+=r,l.y+=i,t.save();let n=ze.normals(s,l);n[0].normalize(),n[1].normalize();let f=e.getRightChiral(),h,d,g,c,b=e.clone();f?(h=l,d=s,b.shortenRight(1),g=b.getRightVector().clone(),c=b.getLeftVector().clone()):(h=s,d=l,b.shortenLeft(1),g=b.getLeftVector().clone(),c=b.getRightVector().clone()),g.x+=r,g.y+=i,c.x+=r,c.y+=i;let x=ze.subtract(d,h).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let y=e.getLength(),L=1.25/(y/(this.opts.bondThickness*3)),A=!1;for(var H=0;H<1;H+=L){let B=ze.multiplyScalar(x,H*y),k=ze.add(h,B),$=1.5*H,J=ze.multiplyScalar(n[0],$);!A&&H>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),A=!0),k.subtract(J),t.moveTo(k.x,k.y),k.add(ze.multiplyScalar(J,2)),t.lineTo(k.x,k.y)}t.stroke(),t.restore()}drawDebugText(e,t,r){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,r){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,Zt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawPoint(e,t,r){let i=this.ctx,s=this.offsetX,l=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+s,t+l,1.5,0,Zt.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,Zt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawText(e,t,r,i,s,l,n,f,h,d={}){let g=this.ctx,c=this.offsetX,b=this.offsetY;g.save(),g.textAlign="start",g.textBaseline="alphabetic";let x=!1,y="",L=0;n&&(y=tn(n),g.font=this.fontSmall,L=g.measureText(y).width);let A="0",H=0;f>0&&(A=f.toString(),g.font=this.fontSmall,H=g.measureText(A).width),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),g.font=this.fontLarge,g.fillStyle=this.themeManager.getColor("BACKGROUND");let B=g.measureText(r);B.totalWidth=B.width+L,B.height=parseInt(this.fontLarge,10);let k=B.width>this.opts.fontSizeLarge?B.width:this.opts.fontSizeLarge;k/=1.5,g.globalCompositeOperation="destination-out",g.beginPath(),g.arc(e+c,t+b,k,0,Zt.twoPI,!0),g.closePath(),g.fill(),g.globalCompositeOperation="source-over";let $=-B.width/2,J=-B.width/2;g.fillStyle=this.themeManager.getColor(r),g.fillText(r,e+c+$,t+this.opts.halfFontSizeLarge+b),$+=B.width,n&&(g.font=this.fontSmall,g.fillText(y,e+c+$,t-this.opts.fifthFontSizeSmall+b),$+=L),f>0&&(g.font=this.fontSmall,g.fillText(A,e+c+J-H,t-this.opts.fifthFontSizeSmall+b),J-=H),g.font=this.fontLarge;let Q=0,ue=0;if(i===1){let ne=e+c,j=t+b+this.opts.halfFontSizeLarge;Q=this.hydrogenWidth,J-=Q,s==="left"?ne+=J:s==="right"||s==="up"&&l||s==="down"&&l?ne+=$:s==="up"&&!l?(j-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth):s==="down"&&!l&&(j+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth),g.fillText("H",ne,j),$+=Q}else if(i>1){let ne=e+c,j=t+b+this.opts.halfFontSizeLarge;Q=this.hydrogenWidth,g.font=this.fontSmall,ue=g.measureText(i).width,J-=Q+ue,s==="left"?ne+=J:s==="right"||s==="up"&&l||s==="down"&&l?ne+=$:s==="up"&&!l?(j-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth):s==="down"&&!l&&(j+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,ne-=this.halfHydrogenWidth),g.font=this.fontLarge,g.fillText("H",ne,j),g.font=this.fontSmall,g.fillText(i,ne+this.halfHydrogenWidth+ue,j+this.opts.fifthFontSizeSmall),$+=Q+this.halfHydrogenWidth+ue}if(x){g.restore();return}for(let ne in d){if(!d.hasOwnProperty(ne))continue;let j=0,ee=0,me=d[ne].element,fe=d[ne].count,xe=d[ne].hydrogenCount,We=d[ne].charge;g.font=this.fontLarge,fe>1&&xe>0&&(j=g.measureText("(").width,ee=g.measureText(")").width);let He=g.measureText(me).width,Ke=0,Je="",lt=0;Q=0,xe>0&&(Q=this.hydrogenWidth),g.font=this.fontSmall,fe>1&&(Ke=g.measureText(fe).width),We!==0&&(Je=tn(We),lt=g.measureText(Je).width),ue=0,xe>1&&(ue=g.measureText(xe).width),g.font=this.fontLarge;let Ae=e+c,Se=t+b+this.opts.halfFontSizeLarge;g.fillStyle=this.themeManager.getColor(me),fe>0&&(J-=Ke),fe>1&&xe>0&&(s==="left"?(J-=ee,g.fillText(")",Ae+J,Se)):(g.fillText("(",Ae+$,Se),$+=j)),s==="left"?(J-=He,g.fillText(me,Ae+J,Se)):(g.fillText(me,Ae+$,Se),$+=He),xe>0&&(s==="left"?(J-=Q+ue,g.fillText("H",Ae+J,Se),xe>1&&(g.font=this.fontSmall,g.fillText(xe,Ae+J+Q,Se+this.opts.fifthFontSizeSmall))):(g.fillText("H",Ae+$,Se),$+=Q,xe>1&&(g.font=this.fontSmall,g.fillText(xe,Ae+$,Se+this.opts.fifthFontSizeSmall),$+=ue))),g.font=this.fontLarge,fe>1&&xe>0&&(s==="left"?(J-=j,g.fillText("(",Ae+J,Se)):(g.fillText(")",Ae+$,Se),$+=ee)),g.font=this.fontSmall,fe>1&&(s==="left"?g.fillText(fe,Ae+J+j+ee+Q+ue+He,Se+this.opts.fifthFontSizeSmall):(g.fillText(fe,Ae+$,Se+this.opts.fifthFontSizeSmall),$+=Ke)),We!==0&&(s==="left"?g.fillText(Je,Ae+J+j+ee+Q+ue+He,t-this.opts.fifthFontSizeSmall+b):(g.fillText(Je,Ae+$,t-this.opts.fifthFontSizeSmall+b),$+=lt))}g.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,r="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,r)}drawAromaticityRing(e){let t=this.ctx,r=Zt.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};rn.exports=hi});var xr=ve((ba,an)=>{var sn=Yt(),va=st(),cs=Pt(),ds=li(),ma=Ut(),ps=lr(),ui=class M{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.atomIdxToVertexId=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._atomIdx=0,this._time=0,this._init(e)}_init(e,t=0,r=null,i=!1){let s=e.atom.element?e.atom.element:e.atom,l=new ps(s,e.bond);(s!=="H"||!e.hasNext&&r===null)&&(l.idx=this._atomIdx,this._atomIdx++),l.branchBond=e.branchBond,l.ringbonds=e.ringbonds,l.bracket=e.atom.element?e.atom:null,l.class=e.atom.class;let n=new cs(l),f=this.vertices[r];if(this.addVertex(n),l.idx!==null&&this.atomIdxToVertexId.push(n.id),r!==null){n.setParentVertexId(r),n.value.addNeighbouringElement(f.value.element),f.addChild(n.id),f.value.addNeighbouringElement(l.element),f.spanningTreeChildren.push(n.id);let c=new ds(r,n.id,1),b=null;i?(c.setBondType(n.value.branchBond||"-"),b=n.id,c.setBondType(n.value.branchBond||"-"),b=n.id):(c.setBondType(f.value.bondType||"-"),b=f.id);let x=this.addEdge(c)}let h=e.ringbondCount+1;l.bracket&&(h+=l.bracket.hcount);let d=0;if(l.bracket&&l.bracket.chirality){l.isStereoCenter=!0,d=l.bracket.hcount;for(var g=0;g<d;g++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},g,n.id,!0)}for(var g=0;g<e.branchCount;g++)this._init(e.branches[g],g+h,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+h,n.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}getEdge(e,t){let r=this.vertexIdsToEdgeId[e+"_"+t];return r===void 0?null:this.edges[r]}getEdges(e){let t=Array(),r=this.vertices[e];for(var i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let s=this.edges[r];t[s.sourceId][s.targetId]=1,t[s.targetId][s.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),r=this.getBridges();for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let l=this.edges[i];t[l.sourceId][l.targetId]=1,t[l.targetId][l.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&(r[i][s]=1)}return r}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e);for(var i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var s=0;s<e;s++)t[i][s]===1&&(r[i][s]=1);for(var l=0;l<e;l++)for(var i=0;i<e;i++)for(var s=0;s<e;s++)r[i][s]>r[i][l]+r[l][s]&&(r[i][s]=r[i][l]+r[l][s]);return r}getSubgraphDistanceMatrix(e){let t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t);for(var s=0;s<t;s++)i[s]=Array(t),i[s].fill(1/0);for(var s=0;s<t;s++)for(var l=0;l<t;l++)r[s][l]===1&&(i[s][l]=1);for(var n=0;n<t;n++)for(var s=0;s<t;s++)for(var l=0;l<t;l++)i[s][l]>i[s][n]+i[n][l]&&(i[s][l]=i[s][n]+i[n][l]);return i}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}getSubgraphAdjacencyList(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=Array();for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&r[i].push(s)}return r}getBridges(){let e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),s=new Array(e),l=this.getAdjacencyList(),n=Array();t.fill(!1),s.fill(null),this._time=0;for(var f=0;f<e;f++)t[f]||this._bridgeDfs(f,t,r,i,s,l,n);return n}traverseBF(e,t){let r=this.vertices.length,i=new Array(r);i.fill(!1);for(var s=[e];s.length>0;){let n=s.shift(),f=this.vertices[n];t(f);for(var l=0;l<f.neighbours.length;l++){let h=f.neighbours[l];i[h]||(i[h]=!0,s.push(h))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let r=this.vertices[e].getSpanningTreeNeighbours(t),i=0;for(var s=0;s<r.length;s++){let l=r[s],n=this.getTreeDepth(l,e);n>i&&(i=n)}return i+1}traverseTree(e,t,r,i=999999,s=!1,l=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),l>i+1||n[e]===1)return;n[e]=1;let f=this.vertices[e],h=f.getNeighbours(t);(!s||l>1)&&r(f);for(var d=0;d<h.length;d++)this.traverseTree(h[d],e,r,i,s,l+1,n)}kkLayout(e,t,r,i,s,l=.1,n=.1,f=2e3,h=50,d=1e9){let g=s;for(var c=e.length;c--;)var b=this.vertices[e[c]].neighbours.length;let x=this.getSubgraphDistanceMatrix(e),y=e.length,L=sn.polyCircumradius(500,y),A=sn.centralAngle(y),H=0,B=new Float32Array(y),k=new Float32Array(y),$=Array(y);for(c=y;c--;){let U=this.vertices[e[c]];U.positioned?(B[c]=U.position.x,k[c]=U.position.y):(B[c]=t.x+Math.cos(H)*L,k[c]=t.y+Math.sin(H)*L),$[c]=U.positioned,H+=A}let J=Array(y);for(c=y;c--;){J[c]=new Array(y);for(var b=y;b--;)J[c][b]=s*x[c][b]}let Q=Array(y);for(c=y;c--;){Q[c]=Array(y);for(var b=y;b--;)Q[c][b]=g*Math.pow(x[c][b],-2)}let ue=Array(y),ne=new Float32Array(y),j=new Float32Array(y);for(c=y;c--;)ue[c]=Array(y);c=y;let ee,me,fe,xe,We,He,Ke;for(;c--;){ee=B[c],me=k[c],fe=0,xe=0;let U=y;for(;U--;)c!==U&&(We=B[U],He=k[U],Ke=1/Math.sqrt((ee-We)*(ee-We)+(me-He)*(me-He)),ue[c][U]=[Q[c][U]*(ee-We-J[c][U]*(ee-We)*Ke),Q[c][U]*(me-He-J[c][U]*(me-He)*Ke)],ue[U][c]=ue[c][U],fe+=ue[c][U][0],xe+=ue[c][U][1]);ne[c]=fe,j[c]=xe}let Je=function(U){return[ne[U]*ne[U]+j[U]*j[U],ne[U],j[U]]},lt=function(){let U=0,Ne=0,Qe=0,Be=0;for(c=y;c--;){let[et,Ge,Xe]=Je(c);et>U&&$[c]===!1&&(U=et,Ne=c,Qe=Ge,Be=Xe)}return[Ne,U,Qe,Be]},Ae=function(U,Ne,Qe){let Be=0,et=0,Ge=0,Xe=B[U],_e=k[U],Nt=J[U],Ze=Q[U];for(c=y;c--;){if(c===U)continue;let nt=B[c],tt=k[c],ut=Nt[c],gt=Ze[c],ft=(Xe-nt)*(Xe-nt),Et=1/Math.pow(ft+(_e-tt)*(_e-tt),1.5);Be+=gt*(1-ut*(_e-tt)*(_e-tt)*Et),et+=gt*(1-ut*ft*Et),Ge+=gt*(ut*(Xe-nt)*(_e-tt)*Et)}Be===0&&(Be=.1),et===0&&(et=.1),Ge===0&&(Ge=.1);let Ie=Ne/Be+Qe/Ge;Ie/=Ge/Be-et/Ge;let Le=-(Ge*Ie+Ne)/Be;B[U]+=Le,k[U]+=Ie;let ke=ue[U];Ne=0,Qe=0,Xe=B[U],_e=k[U];let ot,ye,Rt,pt,ht;for(c=y;c--;)U!==c&&(ot=B[c],ye=k[c],Rt=ke[c][0],pt=ke[c][1],ht=1/Math.sqrt((Xe-ot)*(Xe-ot)+(_e-ye)*(_e-ye)),Le=Ze[c]*(Xe-ot-Nt[c]*(Xe-ot)*ht),Ie=Ze[c]*(_e-ye-Nt[c]*(_e-ye)*ht),ke[c]=[Le,Ie],Ne+=Le,Qe+=Ie,ne[c]+=Le-Rt,j[c]+=Ie-pt);ne[U]=Ne,j[U]=Qe},Se=0,St=0,At=0,Ct=0,It=0,xt=0;for(;d>l&&f>It;)for(It++,[Se,d,St,At]=lt(),Ct=d,xt=0;Ct>n&&h>xt;)xt++,Ae(Se,St,At),[Ct,St,At]=Je(Se);for(c=y;c--;){let U=e[c],Ne=this.vertices[U];Ne.position.x=B[c],Ne.position.y=k[c],Ne.positioned=!0,Ne.forcePositioned=!0}}_bridgeDfs(e,t,r,i,s,l,n){t[e]=!0,r[e]=i[e]=++this._time;for(var f=0;f<l[e].length;f++){let h=l[e][f];t[h]?h!==s[e]&&(i[e]=Math.min(i[e],r[h])):(s[h]=e,this._bridgeDfs(h,t,r,i,s,l,n),i[e]=Math.min(i[e],i[h]),i[h]>r[e]&&n.push([e,h]))}}static getConnectedComponents(e){let t=e.length,r=new Array(t),i=new Array,s=0;r.fill(!1);for(var l=0;l<t;l++)if(!r[l]){let n=Array();r[l]=!0,n.push(l),s++,M._ccGetDfs(l,r,e,n),n.length>1&&i.push(n)}return i}static getConnectedComponentCount(e){let t=e.length,r=new Array(t),i=0;r.fill(!1);for(var s=0;s<t;s++)r[s]||(r[s]=!0,i++,M._ccCountDfs(s,r,e));return i}static _ccCountDfs(e,t,r){for(var i=0;i<r[e].length;i++)!r[e][i]||t[i]||e===i||(t[i]=!0,M._ccCountDfs(i,t,r))}static _ccGetDfs(e,t,r,i){for(var s=0;s<r[e].length;s++)!r[e][s]||t[s]||e===s||(t[s]=!0,i.push(s),M._ccGetDfs(s,t,r,i))}};an.exports=ui});var on=ve((wa,ln)=>{var vs=xr(),gi=class M{static getRings(e,t=!1){let r=e.getComponentsAdjacencyMatrix();if(r.length===0)return null;let i=vs.getConnectedComponents(r),s=Array();for(var l=0;l<i.length;l++){let h=i[l],d=e.getSubgraphAdjacencyMatrix([...h]),g=new Uint16Array(d.length),c=new Uint16Array(d.length);for(var n=0;n<d.length;n++){c[n]=0,g[n]=0;for(var f=0;f<d[n].length;f++)g[n]+=d[n][f]}let b=0;for(var n=0;n<d.length;n++)for(var f=n+1;f<d.length;f++)b+=d[n][f];let x=b-d.length+1,y=!0;for(var n=0;n<g.length;n++)g[n]!==3&&(y=!1);if(y&&(x=2+b-d.length),x===1){s.push([...h]);continue}t&&(x=999);let{d:L,pe:A,pe_prime:H}=M.getPathIncludedDistanceMatrices(d),B=M.getRingCandidates(L,A,H),k=M.getSSSR(B,L,d,A,H,g,c,x);for(var n=0;n<k.length;n++){let J=Array(k[n].size),Q=0;for(let ue of k[n])J[Q++]=h[ue];s.push(J)}}return s}static matrixToString(e){let t="";for(var r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,r=Array(t),i=Array(t),s=Array(t);for(var l=0,n=0,f=0,h=t;h--;){r[h]=Array(t),i[h]=Array(t),s[h]=Array(t);for(var g=t;g--;)r[h][g]=h===g||e[h][g]===1?e[h][g]:Number.POSITIVE_INFINITY,r[h][g]===1?i[h][g]=[[[h,g]]]:i[h][g]=Array(),s[h][g]=Array()}for(var d=t,g;d--;)for(h=t;h--;)for(g=t;g--;){let c=r[h][g],b=r[h][d]+r[d][g];if(c>b){var l,n,f;if(c===b+1)for(s[h][g]=[i[h][g].length],l=i[h][g].length;l--;)for(s[h][g][l]=[i[h][g][l].length],n=i[h][g][l].length;n--;)for(s[h][g][l][n]=[i[h][g][l][n].length],f=i[h][g][l][n].length;f--;)s[h][g][l][n][f]=[i[h][g][l][n][0],i[h][g][l][n][1]];else s[h][g]=Array();for(r[h][g]=b,i[h][g]=[[]],l=i[h][d][0].length;l--;)i[h][g][0].push(i[h][d][0][l]);for(l=i[d][g][0].length;l--;)i[h][g][0].push(i[d][g][0][l])}else if(c===b){if(i[h][d].length&&i[d][g].length){var l;if(i[h][g].length){let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][g][0].length;l--;)y.push(i[d][g][0][l]);i[h][g].push(y)}else{let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][g][0].length;l--;)y.push(i[d][g][0][l]);i[h][g][0]=y}}}else if(c===b-1){var l;if(s[h][g].length){let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][g][0].length;l--;)y.push(i[d][g][0][l]);s[h][g].push(y)}else{let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][g][0].length;l--;)y.push(i[d][g][0][l]);s[h][g][0]=y}}}return{d:r,pe:i,pe_prime:s}}static getRingCandidates(e,t,r){let i=e.length,s=Array(),l=0;for(let n=0;n<i;n++)for(let f=0;f<i;f++)e[n][f]===0||t[n][f].length===1&&r[n][f]===0||(r[n][f].length!==0?l=2*(e[n][f]+.5):l=2*e[n][f],l!==1/0&&s.push([l,t[n][f],r[n][f]]));return s.sort(function(n,f){return n[0]-f[0]}),s}static getSSSR(e,t,r,i,s,l,n,f){let h=Array(),d=Array();for(let c=0;c<e.length;c++)if(e[c][0]%2!==0)for(let b=0;b<e[c][2].length;b++){let x=e[c][1][0].concat(e[c][2][b]);for(var g=0;g<x.length;g++)x[g][0].constructor===Array&&(x[g]=x[g][0]);let y=M.bondsToAtoms(x);if(M.getBondCount(y,r)===y.size&&!M.pathSetsContain(h,y,x,d,l,n)&&(h.push(y),d=d.concat(x)),h.length>f)return h}else for(let b=0;b<e[c][1].length-1;b++){let x=e[c][1][b].concat(e[c][1][b+1]);for(var g=0;g<x.length;g++)x[g][0].constructor===Array&&(x[g]=x[g][0]);let y=M.bondsToAtoms(x);if(M.getBondCount(y,r)===y.size&&!M.pathSetsContain(h,y,x,d,l,n)&&(h.push(y),d=d.concat(x)),h.length>f)return h}return h}static getEdgeCount(e){let t=0,r=e.length;for(var i=r-1;i--;)for(var s=r;s--;)e[i][s]===1&&t++;return t}static getEdgeList(e){let t=e.length,r=Array();for(var i=t-1;i--;)for(var s=t;s--;)e[i][s]===1&&r.push([i,s]);return r}static bondsToAtoms(e){let t=new Set;for(var r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}static getBondCount(e,t){let r=0;for(let i of e)for(let s of e)i!==s&&(r+=t[i][s]);return r/2}static pathSetsContain(e,t,r,i,s,l){for(var n=e.length;n--;){if(M.isSupersetOf(t,e[n]))return!0;if(e[n].size===t.size&&M.areSetsEqual(e[n],t))return!0}let f=0,h=!1;for(n=r.length;n--;)for(var d=i.length;d--;)(r[n][0]===i[d][0]&&r[n][1]===i[d][1]||r[n][1]===i[d][0]&&r[n][0]===i[d][1])&&f++,f===r.length&&(h=!0);let g=!1;if(h){for(let c of t)if(l[c]<s[c]){g=!0;break}}if(h&&!g)return!0;for(let c of t)l[c]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}static isSupersetOf(e,t){for(var r of t)if(!e.has(r))return!1;return!0}};ln.exports=gi});var Nr=ve((ya,hn)=>{var fi=class{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}};hn.exports=fi});var Rr=ve((Sa,un)=>{var ci=class{static extend(){let e=this,t={},r=!1,i=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],i++);let l=function(n){for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&(r&&Object.prototype.toString.call(n[f])==="[object Object]"?t[f]=e.extend(!0,t[f],n[f]):t[f]=n[f])};for(;i<s;i++){let n=arguments[i];l(n)}return t}};un.exports=ci});var dn=ve((Ca,cn)=>{var Ee=Yt(),at=Vt(),K=st(),Ce=or(),Aa=Pt(),ms=li(),Er=lr(),gn=Ut(),Tr=ti(),bs=nn(),fn=xr(),ws=on(),ys=Nr(),Ss=Rr(),di=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaa",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"},oldschool:{C:"#000",O:"#000",N:"#000",F:"#000",CL:"#000",BR:"#000",I:"#000",P:"#000",S:"#000",B:"#000",SI:"#000",H:"#000",BACKGROUND:"#fff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#fff"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#fff"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#fff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#fff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#fff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#fff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"}}},this.opts=Ss.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,t,r="light",i=!1){this.initDraw(e,r,i),this.infoOnly||(this.themeManager=new ys(this.opts.themes,r),this.canvasWrapper=new bs(t,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){let r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,r=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];if(n.value.isDrawn)for(var s=i+1;s<this.graph.vertices.length;s++){let f=this.graph.vertices[s];if(!f.value.isDrawn)continue;let h=n.position.distanceSq(f.position);h>r&&(r=h,e=i,t=s)}}let l=-K.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(l)){let n=l%.523599;n<.2617995?l=l-n:l+=.523599-n;for(var i=0;i<this.graph.vertices.length;i++)i!==t&&this.graph.vertices[i].position.rotateAround(l,this.graph.vertices[t].position);for(var i=0;i<this.rings.length;i++)this.rings[i].center.rotateAround(l,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let t="",r=new Map,i=e===null?this.graph:new fn(e,this.opts.isomeric);for(var s=0;s<i.vertices.length;s++){let n=i.vertices[s].value;if(r.has(n.element)?r.set(n.element,r.get(n.element)+1):r.set(n.element,1),n.bracket&&!n.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+n.bracket.hcount):r.set("H",n.bracket.hcount)),!n.bracket){let f=Er.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&f--,r.has("H")?r.set("H",r.get("H")+f):r.set("H",f)}}if(r.has("C")){let n=r.get("C");t+="C"+(n>1?n:""),r.delete("C")}if(r.has("H")){let n=r.get("H");t+="H"+(n>1?n:""),r.delete("H")}return Object.keys(Er.atomicNumbers).sort().map(n=>{if(r.has(n)){let f=r.get(n);t+=n+(f>1?f:"")}}),t}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return e.value.ringbonds[r].bondType==="-"?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}initDraw(e,t,r,i){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new fn(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){let i=this.graph.edges[r];if(this.isEdgeRotatable(i)){let s=this.graph.getTreeDepth(i.sourceId,i.targetId),l=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,f=i.sourceId;if(s>l&&(n=i.sourceId,f=i.targetId),this.getSubtreeOverlapScore(f,n,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[n],g=this.graph.vertices[f],c=g.getNeighbours(n);if(c.length===1){let b=this.graph.vertices[c[0]],x=b.position.getRotateAwayFromAngle(d.position,g.position,Ee.toRad(120));this.rotateSubtree(b.id,g.id,x,g.position);let y=this.getOverlapScore().total;y>this.totalOverlapScore?this.rotateSubtree(b.id,g.id,-x,g.position):this.totalOverlapScore=y}else if(c.length===2){if(g.value.rings.length!==0&&d.value.rings.length!==0)continue;let b=this.graph.vertices[c[0]],x=this.graph.vertices[c[1]];if(b.value.rings.length===1&&x.value.rings.length===1){if(b.value.rings[0]!==x.value.rings[0])continue}else{if(b.value.rings.length!==0||x.value.rings.length!==0)continue;{let y=b.position.getRotateAwayFromAngle(d.position,g.position,Ee.toRad(120)),L=x.position.getRotateAwayFromAngle(d.position,g.position,Ee.toRad(120));this.rotateSubtree(b.id,g.id,y,g.position),this.rotateSubtree(x.id,g.id,L,g.position);let A=this.getOverlapScore().total;A>this.totalOverlapScore?(this.rotateSubtree(b.id,g.id,-y,g.position),this.rotateSubtree(x.id,g.id,-L,g.position)):this.totalOverlapScore=A}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let s=this.graph.vertices[t];if(s.value.ringbonds.length!==0)for(var r=0;r<s.value.ringbonds.length;r++){let l=s.value.ringbonds[r].id,n=s.value.ringbonds[r].bond;if(!e.has(l))e.set(l,[s.id,n]);else{let f=s.id,h=e.get(l)[0],d=e.get(l)[1],g=new ms(f,h,1);g.setBondType(d||n||"-");let c=this.graph.addEdge(g),b=this.graph.vertices[h];s.addRingbondChild(h,r),s.value.addNeighbouringElement(b.value.element),b.addRingbondChild(f,r),b.value.addNeighbouringElement(s.value.element),s.edges.push(c),b.edges.push(c),e.delete(l)}}}let i=ws.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(var t=0;t<i.length;t++){let l=[...i[t]],n=this.addRing(new gn(l));for(var r=0;r<l.length;r++)this.graph.vertices[l[r]].value.rings.push(n)}for(var t=0;t<this.rings.length-1;t++)for(var r=t+1;r<this.rings.length;r++){let n=this.rings[t],f=this.rings[r],h=new Tr(n,f);h.vertices.size>0&&this.addRingConnection(h)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];l.neighbours=Tr.getNeighbours(this.ringConnections,l.id)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];this.graph.vertices[l.members[0]].value.addAnchoredRing(l.id)}for(this.backupRingInformation();this.rings.length>0;){let s=-1;for(var t=0;t<this.rings.length;t++){let h=this.rings[t];this.isPartOfBridgedRing(h.id)&&!h.isBridged&&(s=h.id)}if(s===-1)break;let l=this.getRing(s),n=this.getBridgedRingRings(l.id);this.bridgedRing=!0,this.createBridgedRing(n,l.members[0]),this.bridgedRing=!1;for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),r=this,i=function(s){let l=r.getRing(s);t.push(s);for(var n=0;n<l.neighbours.length;n++){let f=l.neighbours[n];t.indexOf(f)===-1&&f!==s&&Tr.isBridge(r.ringConnections,r.graph.vertices,s,f)&&i(f)}};return i(e),at.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let r=new Set,i=new Set,s=new Set;for(var l=0;l<e.length;l++){let c=this.getRing(e[l]);c.isPartOfBridged=!0;for(var n=0;n<c.members.length;n++)i.add(c.members[n]);for(var n=0;n<c.neighbours.length;n++){let x=c.neighbours[n];e.indexOf(x)===-1&&s.add(c.neighbours[n])}}let f=new Set;for(let c of i){let b=this.graph.vertices[c],x=at.intersection(e,b.value.rings);b.value.rings.length===1||x.length===1?r.add(b.id):f.add(b.id)}let h=Array(),d=Array();for(let c of f){let b=this.graph.vertices[c],x=!1;for(let y=0;y<b.edges.length;y++)this.edgeRingCount(b.edges[y])===1&&(x=!0);x?(b.value.isBridgeNode=!0,r.add(b.id)):(b.value.isBridge=!0,r.add(b.id))}let g=new gn([...r]);this.addRing(g),g.isBridged=!0,g.neighbours=[...s];for(var l=0;l<e.length;l++)g.rings.push(this.getRing(e[l]).clone());for(var l=0;l<g.members.length;l++)this.graph.vertices[g.members[l]].value.bridgedRing=g.id;for(var l=0;l<d.length;l++){let b=this.graph.vertices[d[l]];b.value.rings=Array()}for(let c of r){let b=this.graph.vertices[c];b.value.rings=at.removeAll(b.value.rings,e),b.value.rings.push(g.id)}for(var l=0;l<e.length;l++)for(var n=l+1;n<e.length;n++)this.removeRingConnectionsBetween(e[l],e[n]);for(let c of s){let b=this.getRingConnections(c,e);for(var n=0;n<b.length;n++)this.getRingConnection(b[n]).updateOther(g.id,c);this.getRing(c).neighbours.push(g.id)}return g}areVerticesInSameRing(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}getCommonRings(e,t){let r=Array();for(var i=0;i<e.value.rings.length;i++)for(var s=0;s<t.value.rings.length;s++)e.value.rings[i]==t.value.rings[s]&&r.push(e.value.rings[i]);return r}getLargestOrAromaticCommonRing(e,t){let r=this.getCommonRings(e,t),i=0,s=null;for(var l=0;l<r.length;l++){let n=this.getRing(r[l]),f=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;f>i&&(i=f,s=n)}return s}getVerticesAt(e,t,r){let i=Array();for(var s=0;s<this.graph.vertices.length;s++){let l=this.graph.vertices[s];if(l.id===r||!l.positioned)continue;e.distanceSq(l.position)<=t*t&&i.push(l.id)}return i}getClosestVertex(e){let t=99999,r=null;for(var i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i];if(s.id===e.id)continue;let l=e.position.distanceSq(s.position);l<t&&(t=l,r=s)}return r}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let r=this.rings[t];r.neighbours=r.neighbours.filter(function(i){return i!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];(s.firstRingId===e&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===e)&&r.push(s.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let l=this.ringConnections[i];for(var s=0;s<t.length;s++){let n=t[s];(l.firstRingId===e&&l.secondRingId===n||l.firstRingId===n&&l.secondRingId===e)&&r.push(l.id)}}return r}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){let n=this.graph.vertices[r],f=this.graph.vertices[i];if(!n.value.isDrawn||!f.value.isDrawn)continue;let h=K.subtract(n.position,f.position).lengthSq();if(h<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(h))/this.opts.bondLength;e+=d,t[r]+=d,t[i]+=d}}let s=Array();for(var r=0;r<this.graph.vertices.length;r++)s.push({id:r,score:t[r]});return s.sort(function(l,n){return n.score-l.score}),{total:e,scores:s,vertexScores:t}}chooseSide(e,t,r){let i=e.getNeighbours(t.id),s=t.getNeighbours(e.id),l=i.length,n=s.length,f=at.merge(i,s),h=[0,0];for(var d=0;d<f.length;d++)this.graph.vertices[f[d]].position.sameSideAs(e.position,t.position,r[0])?h[0]++:h[1]++;let g=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,r[0])?g[0]++:g[1]++;return{totalSideCount:g,totalPosition:g[0]>g[1]?0:1,sideCount:h,position:h[0]>h[1]?0:1,anCount:l,bnCount:n}}setRingCenter(e){let t=e.getSize(),r=new K(0,0);for(var i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}getSubringCenter(e,t){let r=t.value.originalRings,i=e.center,s=Number.MAX_VALUE;for(var l=0;l<r.length;l++)for(var n=0;n<e.rings.length;n++)r[l]===e.rings[n].id&&e.rings[n].getSize()<s&&(i=e.rings[n].center,s=e.rings[n].getSize());return i}drawEdges(e){let t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(s){let l=t.graph.getEdges(s.id);for(var n=0;n<l.length;n++){let f=l[n];r[f]||(r[f]=!0,t.drawEdge(f,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){let s=this.rings[i];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(e,t){let r=this,i=this.graph.edges[e],s=this.graph.vertices[i.sourceId],l=this.graph.vertices[i.targetId],n=s.value.element,f=l.value.element;if((!s.value.isDrawn||!l.value.isDrawn)&&this.opts.atomVisualization==="default")return;let h=s.position,d=l.position,g=this.getEdgeNormals(i),c=at.clone(g);if(c[0].multiplyScalar(10).add(h),c[1].multiplyScalar(10).add(h),i.bondType==="="||this.getRingbondType(s,l)==="="||i.isPartOfAromaticRing&&this.bridgedRing){let b=this.areVerticesInSameRing(s,l),x=this.chooseSide(s,l,c);if(b){let L=this.getLargestOrAromaticCommonRing(s,l).center;g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let A=null;L.sameSideAs(s.position,l.position,K.add(h,g[0]))?A=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f):A=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f),A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(A,!0):this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}else if(i.center||s.isTerminal()&&l.isTerminal()){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let y=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f),L=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f);this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(L)}else if(x.anCount==0&&x.bnCount>1||x.bnCount==0&&x.anCount>1){g[0].multiplyScalar(r.opts.halfBondSpacing),g[1].multiplyScalar(r.opts.halfBondSpacing);let y=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f),L=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f);this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(L)}else if(x.sideCount[0]>x.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let y=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}else if(x.sideCount[0]<x.sideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let y=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}else if(x.totalSideCount[0]>x.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let y=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}else if(x.totalSideCount[0]<=x.totalSideCount[1]){g[0].multiplyScalar(r.opts.bondSpacing),g[1].multiplyScalar(r.opts.bondSpacing);let y=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}}else if(i.bondType==="#"){g[0].multiplyScalar(r.opts.bondSpacing/1.5),g[1].multiplyScalar(r.opts.bondSpacing/1.5);let b=new Ce(K.add(h,g[0]),K.add(d,g[0]),n,f),x=new Ce(K.add(h,g[1]),K.add(d,g[1]),n,f);this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new Ce(h,d,n,f))}else if(i.bondType!=="."){let b=s.value.isStereoCenter,x=l.value.isStereoCenter;i.wedge==="up"?this.canvasWrapper.drawWedge(new Ce(h,d,n,f,b,x)):i.wedge==="down"?this.canvasWrapper.drawDashedWedge(new Ce(h,d,n,f,b,x)):this.canvasWrapper.drawLine(new Ce(h,d,n,f,b,x))}if(t){let b=K.midpoint(h,d);this.canvasWrapper.drawDebugText(b.x,b.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],s=i.value,l=0,n=0,f=i.value.bondCount,h=s.element,d=Er.maxBonds[h]-f,g=i.getTextDirection(this.graph.vertices),c=this.opts.terminalCarbons||h!=="C"||s.hasAttachedPseudoElements?i.isTerminal():!1,b=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(d=0),s.bracket&&(d=s.bracket.hcount,l=s.bracket.charge,n=s.bracket.isotope),(l||n||graph.vertices.length<3)&&(b=!1),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(s.isDrawn&&(!b||s.drawExplicit||c||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(i.position.x,i.position.y,h,d,g,c,l,n,this.graph.vertices.length,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(i.getNeighbourCount()===2&&i.forcePositioned==!0){let x=this.graph.vertices[i.neighbours[0]].position,y=this.graph.vertices[i.neighbours[1]].position,L=K.threePointangle(i.position,x,y);Math.abs(Math.PI-L)<.1&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,h)}if(e){let x="v: "+i.id+" "+at.print(s.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,x)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let i=this.rings[t].center;this.canvasWrapper.drawDebugPoint(i.x,i.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let i=e[t];for(var r=0;r<i.rings.length;r++){let s=i.rings[r];this.originalRings[s.id].center=s.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,i=null){if(e.positioned)return;t=t||new K(0,0);let s=e.getOrderedNeighbours(this.ringConnections),l=r?K.subtract(r.position,t).angle():0,n=Ee.polyCircumradius(this.opts.bondLength,e.getSize()),f=Ee.centralAngle(e.getSize());e.centralAngle=f;let h=l,d=this,g=r?r.id:null;if(e.members.indexOf(g)===-1&&(r&&(r.positioned=!1),g=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var c=0;c<e.rings.length;c++)this.setRingCenter(e.rings[c])}else e.eachMember(this.graph.vertices,function(x){let y=d.graph.vertices[x];y.positioned||y.setPosition(t.x+Math.cos(h)*n,t.y+Math.sin(h)*n),h+=f,(!e.isBridged||e.rings.length<3)&&(y.angle=h,y.positioned=!0)},g,i?i.id:null);e.positioned=!0,e.center=t;for(var c=0;c<s.length;c++){let y=this.getRing(s[c].neighbour);if(y.positioned)continue;let L=Tr.getVertices(this.ringConnections,e.id,y.id);if(L.length===2){e.isFused=!0,y.isFused=!0;let A=this.graph.vertices[L[0]],H=this.graph.vertices[L[1]],B=K.midpoint(A.position,H.position),k=K.normals(A.position,H.position);k[0].normalize(),k[1].normalize();let $=Ee.polyCircumradius(this.opts.bondLength,y.getSize()),J=Ee.apothem($,y.getSize());k[0].multiplyScalar(J).add(B),k[1].multiplyScalar(J).add(B);let Q=k[0];K.subtract(t,k[1]).lengthSq()>K.subtract(t,k[0]).lengthSq()&&(Q=k[1]);let ue=K.subtract(A.position,Q),ne=K.subtract(H.position,Q);ue.clockwise(ne)===-1?y.positioned||this.createRing(y,Q,A,H):y.positioned||this.createRing(y,Q,H,A)}else if(L.length===1){e.isSpiro=!0,y.isSpiro=!0;let A=this.graph.vertices[L[0]],H=K.subtract(t,A.position);H.invert(),H.normalize();let B=Ee.polyCircumradius(this.opts.bondLength,y.getSize());H.multiplyScalar(B),H.add(A.position),y.positioned||this.createRing(y,H,A)}}for(var c=0;c<e.members.length;c++){let y=this.graph.vertices[e.members[c]],L=y.neighbours;for(var b=0;b<L.length;b++){let A=this.graph.vertices[L[b]];A.positioned||(A.value.isConnectedToRing=!0,this.createNextBond(A,y,0))}}}rotateSubtree(e,t,r,i){let s=this;this.graph.traverseTree(e,t,function(l){l.position.rotateAround(r,i);for(var n=0;n<l.value.anchoredRings.length;n++){let f=s.rings[l.value.anchoredRings[n]];f&&f.center.rotateAround(r,i)}})}getSubtreeOverlapScore(e,t,r){let i=this,s=0,l=new K(0,0),n=0;return this.graph.traverseTree(e,t,function(f){if(!f.value.isDrawn)return;let h=r[f.id];h>i.opts.overlapSensitivity&&(s+=h,n++);let d=i.graph.vertices[f.id].position.clone();d.multiplyScalar(h),l.add(d)}),l.divide(s),{value:s/n,center:l}}getCurrentCenterOfMass(){let e=new K(0,0),t=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let r=new K(0,0),i=0,s=t*t;for(var l=0;l<this.graph.vertices.length;l++){let n=this.graph.vertices[l];n.positioned&&e.distanceSq(n.position)<s&&(r.add(n.position),i++)}return r.divide(i)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var r=0;r<this.rings.length;r++){let l=this.rings[r];for(var i=0;i<l.members.length;i++){let n=this.graph.vertices[l.members[i]];if(t[n.id])continue;t[n.id]=!0;let f=this.getNonRingNeighbours(n.id);if(f.length>1){let h=Array();for(var s=0;s<n.value.rings.length;s++)h.push(n.value.rings[s]);e.push({common:n,rings:h,vertices:f})}else if(f.length===1&&n.value.rings.length===2){let h=Array();for(var s=0;s<n.value.rings.length;s++)h.push(n.value.rings[s]);e.push({common:n,rings:h,vertices:f})}}}for(var r=0;r<e.length;r++){let n=e[r];if(n.vertices.length===2){let f=n.vertices[0],h=n.vertices[1];if(!f.value.isDrawn||!h.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(n.rings[0]).getAngle())/6;this.rotateSubtree(f.id,n.common.id,d,n.common.position),this.rotateSubtree(h.id,n.common.id,-d,n.common.position);let g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(f.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(h.id,n.common.id,g.vertexScores),x=c.value+b.value;this.rotateSubtree(f.id,n.common.id,-2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,2*d,n.common.position),g=this.getOverlapScore(),c=this.getSubtreeOverlapScore(f.id,n.common.id,g.vertexScores),b=this.getSubtreeOverlapScore(h.id,n.common.id,g.vertexScores),c.value+b.value>x&&(this.rotateSubtree(f.id,n.common.id,2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,-2*d,n.common.position))}else n.vertices.length===1&&n.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let r=this.graph.vertices[e[t].id];if(r.isTerminal()){let i=this.getClosestVertex(r);if(i){let s=null;i.isTerminal()?s=i.id===0?this.graph.vertices[1].position:i.previousPosition:s=i.id===0?this.graph.vertices[1].position:i.position;let l=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(s,l,Ee.toRad(20))}}}}getLastAngle(e){for(;e;){let t=this.graph.vertices[e];if(t.value.rings.length>0)return 0;if(t.angle)return t.angle;e=t.parentVertexId}return 0}createNextBond(e,t=null,r=0,i=!1,s=!1){if(e.positioned&&!s)return;let l=!1;if(t){let f=this.graph.getEdge(e.id,t.id);(f.bondType==="/"||f.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=f.bondType,l=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(t)if(t.value.rings.length>0){let f=t.neighbours,h=null,d=new K(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var n=0;n<f.length;n++){let g=this.graph.vertices[f[n]];if(at.containsAll(g.value.rings,t.value.rings)){h=g;break}}if(h===null){for(var n=0;n<f.length;n++){let c=this.graph.vertices[f[n]];c.positioned&&this.areVerticesInSameRing(c,t)&&d.add(K.subtract(c.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=h.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let f=new K(this.opts.bondLength,0);f.rotate(r),f.add(t.position),e.setPositionFromVector(f),e.previousPosition=t.position,e.positioned=!0}else{let f=new K(this.opts.bondLength,0);f.rotate(Ee.toRad(-60)),e.previousPosition=f,e.setPosition(this.opts.bondLength,0),e.angle=Ee.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let f=this.getRing(e.value.bridgedRing);if(!f.positioned){let h=K.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=Ee.polyCircumradius(this.opts.bondLength,f.members.length);h.multiplyScalar(d),h.add(e.position),this.createRing(f,h,e)}}else if(e.value.rings.length>0){let f=this.getRing(e.value.rings[0]);if(!f.positioned){let h=K.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=Ee.polyCircumradius(this.opts.bondLength,f.getSize());h.multiplyScalar(d),h.add(e.position),this.createRing(f,h,e)}}else{let f=e.value.isStereoCenter,h=e.getNeighbours(),d=Array();for(var n=0;n<h.length;n++)this.graph.vertices[h[n]].value.isDrawn&&d.push(h[n]);t&&(d=at.remove(d,t.id));let g=e.getAngle();if(d.length===1){let c=this.graph.vertices[d[0]],b=t?this.graph.getEdge(e.id,t.id):null,x=this.graph.getEdge(e.id,c.id);if(b&&x&&b.weight+x.weight>=4)b.center=!0,x.center=!0,e.value.drawExplicit=!1,c.drawExplicit=!0,c.angle=0,this.createNextBond(c,e,g+c.angle);else if(t&&t.value.rings.length>0){let y=Ee.toRad(60),L=-y,A=new K(this.opts.bondLength,0),H=new K(this.opts.bondLength,0);A.rotate(y).add(e.position),H.rotate(L).add(e.position);let B=this.getCurrentCenterOfMass(),k=A.distanceSq(B),$=H.distanceSq(B);c.angle=k<$?L:y,this.createNextBond(c,e,g+c.angle)}else{let y=e.angle;if(t&&t.neighbours.length>3?y>0?y=Math.min(1.0472,y):y<0?y=Math.max(-1.0472,y):y=1.0472:y||(y=this.getLastAngle(e.id),y||(y=1.0472)),t&&!l){let L=this.graph.getEdge(e.id,c.id).bondType;L==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(y=-y),this.doubleBondConfig=null):L==="\\"&&(this.doubleBondConfig==="/"?y=-y:this.doubleBondConfig,this.doubleBondConfig=null)}i?c.angle=y:c.angle=-y,this.createNextBond(c,e,g+c.angle)}}else if(d.length===2){let c=e.angle;c||(c=1.0472);let b=this.graph.getTreeDepth(d[0],e.id),x=this.graph.getTreeDepth(d[1],e.id),y=this.graph.vertices[d[0]],L=this.graph.vertices[d[1]];y.value.subtreeDepth=b,L.value.subtreeDepth=x;let A=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=A);let H=0,B=1;L.value.element==="C"&&y.value.element!=="C"&&x>1&&b<5?(H=1,B=0):L.value.element!=="C"&&y.value.element==="C"&&b>1&&x<5?(H=0,B=1):x>b&&(H=1,B=0);let k=this.graph.vertices[d[H]],$=this.graph.vertices[d[B]],J=this.graph.getEdge(e.id,k.id),Q=this.graph.getEdge(e.id,$.id),ue=!1;A<b&&A<x&&(ue=!0),$.angle=c,k.angle=-c,this.doubleBondConfig==="\\"?$.value.branchBond==="\\"&&($.angle=-c,k.angle=c):this.doubleBondConfig==="/"&&$.value.branchBond==="/"&&($.angle=-c,k.angle=c),this.createNextBond($,e,g+$.angle,ue),this.createNextBond(k,e,g+k.angle,ue)}else if(d.length>0){let c=d.map(b=>{let x=this.graph.vertices[b],y=this.graph.getTreeDepth(b,e.id);return x.value.subtreeDepth=y,x});if(c.sort((b,x)=>b.value.subtreeDepth<x.value.subtreeDepth),d.length===3&&t&&t.value.rings.length<1&&c[2].value.rings.length<1&&c[1].value.rings.length<1&&c[0].value.rings.length<1&&c[2].value.subtreeDepth===1&&c[1].value.subtreeDepth===1&&c[0].value.subtreeDepth>1)c[0].angle=-e.angle,e.angle>=0?(c[1].angle=Ee.toRad(30),c[2].angle=Ee.toRad(90)):(c[1].angle=-Ee.toRad(30),c[2].angle=-Ee.toRad(90)),this.createNextBond(c[0],e,g+c[0].angle),this.createNextBond(c[1],e,g+c[1].angle),this.createNextBond(c[2],e,g+c[2].angle);else{let b=d.length+(t?1:0),x=2*Math.PI/b,y=x,L=0;for(d.length%2!==0?(c[0].angle=0,this.createNextBond(c[0],e,g),L=1):y/=2;L<d.length;)c[L+0].angle=y,c[L+1].angle=-y,this.createNextBond(c[L+0],e,g+y),this.createNextBond(c[L+1],e,g-y),y+=x,L+=2}}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var r=0;r<t.length;r++){let i=this.graph.vertices[t[r]];if(at.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let r=this.rings[t];if(!r.positioned)continue;let i=Ee.polyCircumradius(this.opts.bondLength,r.getSize()),s=i*i;if(e.distanceSq(r.center)<s)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||r.isTerminal()||t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return K.units(t,r)}getNonRingNeighbours(e){let t=Array(),r=this.graph.vertices[e],i=r.neighbours;for(var s=0;s<i.length;s++){let l=this.graph.vertices[i[s]];at.intersection(r.value.rings,l.value.rings).length===0&&l.value.isBridge==!1&&t.push(l)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let l=this.graph.vertices[t];if(!l.value.isStereoCenter)continue;let n=l.getNeighbours(),f=n.length,h=Array(f);for(var r=0;r<f;r++){let j=new Uint8Array(this.graph.vertices.length),ee=Array(Array());j[l.id]=1,this.visitStereochemistry(n[r],l.id,j,ee,e,0);for(var i=0;i<ee.length;i++)ee[i].sort(function(me,fe){return fe-me});h[r]=[r,ee]}let d=0,g=0;for(var r=0;r<h.length;r++){h[r][1].length>d&&(d=h[r][1].length);for(var i=0;i<h[r][1].length;i++)h[r][1][i].length>g&&(g=h[r][1][i].length)}for(var r=0;r<h.length;r++){let ee=d-h[r][1].length;for(var i=0;i<ee;i++)h[r][1].push([]);h[r][1].push([n[r]]);for(var i=0;i<h[r][1].length;i++){let fe=g-h[r][1][i].length;for(var s=0;s<fe;s++)h[r][1][i].push(0)}}h.sort(function(j,ee){for(var me=0;me<j[1].length;me++)for(var fe=0;fe<j[1][me].length;fe++){if(j[1][me][fe]>ee[1][me][fe])return-1;if(j[1][me][fe]<ee[1][me][fe])return 1}return 0});let c=new Uint8Array(f);for(var r=0;r<f;r++)c[r]=h[r][0],l.value.priority=r;let b=this.graph.vertices[n[c[0]]].position,x=this.graph.vertices[n[c[1]]].position,y=this.graph.vertices[n[c[2]]].position,L=b.relativeClockwise(x,l.position),A=b.relativeClockwise(y,l.position),H=L===-1,B=l.value.bracket.chirality==="@"?-1:1,k=Ee.parityOfPermutation(c)*B===1?"R":"S",$="down",J="up";(H&&k!=="R"||!H&&k!=="S")&&(l.value.hydrogenDirection="up",$="up",J="down"),l.value.hasHydrogen&&(this.graph.getEdge(l.id,n[c[c.length-1]]).wedge=$);let Q=new Array(n.length-1),ue=l.value.rings.length>1&&l.value.hasHydrogen,ne=l.value.hasHydrogen?1:0;for(var r=0;r<c.length-ne;r++){Q[r]=new Uint32Array(2);let ee=this.graph.vertices[n[c[r]]];Q[r][0]+=ee.value.isStereoCenter?0:1e5,Q[r][0]+=this.areVerticesInSameRing(ee,l)?0:1e4,Q[r][0]+=ee.value.isHeteroAtom()?1e3:0,Q[r][0]-=ee.value.subtreeDepth===0?1e3:0,Q[r][0]+=1e3-ee.value.subtreeDepth,Q[r][1]=n[c[r]]}if(Q.sort(function(j,ee){return j[0]>ee[0]?-1:j[0]<ee[0]?1:0}),!ue){let j=Q[0][1];if(l.value.hasHydrogen)this.graph.getEdge(l.id,j).wedge=J;else{let ee=J;for(var r=c.length-1;r>=0&&(ee===$?ee=J:ee=$,n[c[r]]!==j);r--);this.graph.getEdge(l.id,j).wedge=ee}}l.value.chirality=k}}visitStereochemistry(e,t,r,i,s,l,n=0){r[e]=1;let f=this.graph.vertices[e],h=f.value.getAtomicNumber();i.length<=l&&i.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)i[l].push(n*1e3+h);let g=this.graph.vertices[e].neighbours;for(var d=0;d<g.length;d++)r[g[d]]!==1&&l<s-1&&this.visitStereochemistry(g[d],e,r.slice(),i,s,l+1,h);if(l<s-1){let c=0;for(var d=0;d<g.length;d++)c+=this.graph.getEdge(e,g[d]).weight;for(var d=0;d<f.value.getMaxBonds()-c;d++)i.length<=l+1&&i.push(Array()),i[l+1].push(h*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){let r=this.graph.vertices[e],i=r.neighbours,s=Array(i.length);for(var t=0;t<i.length;t++)s[t]=this.graph.vertices[i[t]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let l=0,n=0;for(var t=0;t<s.length;t++){let d=s[t],g=d.value.element,c=d.getNeighbourCount();g!=="C"&&g!=="H"&&c===1&&l++,c>1&&n++}if(n>1||l<2)continue;let f=null;for(var t=0;t<s.length;t++){let d=s[t];d.getNeighbourCount()>1&&(f=d)}for(var t=0;t<s.length;t++){let d=s[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let g=Er.maxBonds[d.value.element]-d.value.bondCount,c="";d.value.bracket&&(g=d.value.bracket.hcount,c=d.value.bracket.charge||0),r.value.attachPseudoElement(d.value.element,f?f.value.element:null,g,c)}}for(var e=0;e<this.graph.vertices.length;e++){let i=this.graph.vertices[e],s=i.value,l=s.element;if(l==="C"||l==="H"||!s.isDrawn)continue;let n=i.neighbours,f=Array(n.length);for(var t=0;t<n.length;t++)f[t]=this.graph.vertices[n[t]];for(var t=0;t<f.length;t++){let d=f[t].value;if(!d.hasAttachedPseudoElements||d.getAttachedPseudoElementsCount()!==2)continue;let g=d.getAttachedPseudoElements();g.hasOwnProperty("0O")&&g.hasOwnProperty("3C")&&(d.isDrawn=!1,i.value.attachPseudoElement("Ac","",0))}}}};cn.exports=di});var Lr=ve((Na,pn)=>{var{getChargeText:xa}=oi(),As=or(),qe=st(),Cs=Yt();function xs(M){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<M;i++)e+=t.charAt(Math.floor(Math.random()*r));return e}var pi=class M{constructor(e,t,r,i=!0){if(typeof t=="string"||t instanceof String?this.svg=document.getElementById(t):this.svg=t,this.container=null,this.opts=r,this.uid=xs(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths,f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttributeNS(null,"x",this.minX),f.setAttributeNS(null,"y",this.minY),f.setAttributeNS(null,"width",this.maxX-this.minX),f.setAttributeNS(null,"height",this.maxY-this.minY),f.setAttributeNS(null,"fill","white"),t.appendChild(f),t.setAttributeNS(null,"id",this.uid+"-text-mask");for(let h of n)s.appendChild(h);for(let h of this.backgroundItems)r.appendChild(h);for(let h of this.highlights)i.appendChild(h);for(let h of this.vertices)l.appendChild(h);for(let h of this.maskElements)t.appendChild(h);for(let h of this.gradients)e.appendChild(h);if(s.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(s),this.svg.appendChild(l);else return this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(r),this.container.appendChild(s),this.container.appendChild(l),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),s=e.getRightVector(),l=i.x,n=i.y,f=s.x,h=s.y;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",l),t.setAttributeNS(null,"y1",n),t.setAttributeNS(null,"x2",f),t.setAttributeNS(null,"y2",h);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let g=document.createElementNS("http://www.w3.org/2000/svg","stop");return g.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),g.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(g),this.gradients.push(t),r}createSubSuperScripts(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(e){return e===1?"\u207A":e===-1?"\u207B":e>1?M.createUnicodeSuperscript(e)+"\u207A":e<-1?M.createUnicodeSuperscript(e)+"\u207B":""}determineDimensions(e){for(var t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let t=this.minX,r=this.minY,i=this.maxX-this.minX,s=this.maxY-this.minY;if(e<=0)if(i>s){let l=i-s;s=i,r-=l/2}else{let l=s-i;i=s,t-=l/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*s+"px");this.svg.setAttributeNS(null,"viewBox",`${t} ${r} ${i} ${s}`)}drawBall(e,t,r){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r",i),s.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(s)}drawWedge(e){let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=qe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l=t,n=r;s&&(l=r,n=t);let f=qe.add(l,qe.multiplyScalar(i[0],this.halfBondThickness)),h=qe.add(n,qe.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),d=qe.add(n,qe.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),g=qe.add(l,qe.multiplyScalar(i[1],this.halfBondThickness)),c=document.createElementNS("http://www.w3.org/2000/svg","polygon"),b=this.createGradient(e,t.x,t.y,r.x,r.y);c.setAttributeNS(null,"points",`${f.x},${f.y} ${h.x},${h.y} ${d.x},${d.y} ${g.x},${g.y}`),c.setAttributeNS(null,"fill",`url('#${b}')`),this.paths.push(c)}drawAtomHighlight(e,t,r="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",r),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=qe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l,n;s?(l=r,n=t):(l=t,n=r);let f=qe.subtract(n,l).normalize(),h=e.getLength(),d=1.25/(h/(this.opts.bondLength/10)),g=!1,c=this.createGradient(e);for(let b=0;b<1;b+=d){let x=qe.multiplyScalar(f,b*h),y=qe.add(l,x),L=this.opts.fontSizeLarge/2*b,A=qe.multiplyScalar(i[0],L);y.subtract(A);let H=y.clone();H.add(qe.multiplyScalar(A,2)),this.drawLine(new As(y,H),null,c)}}drawDebugPoint(e,t,r="",i="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill","#f00"),this.vertices.push(s),this.drawDebugText(e,t,r)}drawDebugText(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(r)),this.vertices.push(i)}drawRing(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=Cs.apothemFromSideLength(this.opts.bondLength,r);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",s-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,t=!1,r=null,i="round"){let s=this.opts,l=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",t?"5, 5":"none"]],n=e.getLeftVector(),f=e.getRightVector(),h=n.x,d=n.y,g=f.x,c=f.y,b=l.map(y=>y.join(":")).join(";"),x=document.createElementNS("http://www.w3.org/2000/svg","line");x.setAttributeNS(null,"x1",h),x.setAttributeNS(null,"y1",d),x.setAttributeNS(null,"x2",g),x.setAttributeNS(null,"y2",c),x.setAttributeNS(null,"style",b),this.paths.push(x),r==null&&(r=this.createGradient(e,h,d,g,c)),x.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(e,t,r){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","1.5"),s.setAttributeNS(null,"fill","black"),this.maskElements.push(s);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",e),l.setAttributeNS(null,"cy",t),l.setAttributeNS(null,"r",i),l.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(l)}drawText(e,t,r,i,s,l,n,f,h,d={}){let g=[],c=r;n!==0&&n!==null&&(c+=M.createUnicodeCharge(n)),f!==0&&f!==null&&(c=M.createUnicodeSuperscript(f)+c),g.push([c,r]),i===1?g.push(["H","H"]):i>1&&g.push(["H"+M.createUnicodeSubscript(i),"H"]),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let b in d){if(!d.hasOwnProperty(b))continue;let x=d[b],y=x.element;x.count>1&&(y+=M.createUnicodeSubscript(x.count)),x.charge!==""&&(y+=M.createUnicodeCharge(n)),g.push([y,x.element]),x.hydrogenCount===1?g.push(["H","H"]):x.hydrogenCount>1&&g.push(["H"+M.createUnicodeSubscript(x.hydrogenCount),"H"])}this.write(g,s,e,t,h===1)}write(e,t,r,i,s){let l=M.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);t==="left"&&e[0][0]!==e[0][1]&&(l.width*=2),s?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height)):(t!=="right"?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width*e.length<this.minX&&(this.minX=r-l.width*e.length)):t!=="left"&&(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2)),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height),t==="down"&&i+.8*l.height*e.length>this.maxY&&(this.maxY=i+.8*l.height*e.length),t==="up"&&i-.8*l.height*e.length<this.minY&&(this.minY=i-.8*l.height*e.length));let n=r,f=i,h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttributeNS(null,"class","element");let d=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill","#ffffff"),t==="left"&&(e=e.reverse()),(t==="right"||t==="down"||t==="up")&&(r-=l.width/2),t==="left"&&(r+=l.width/2),e.forEach((b,x)=>{let y=b[0],L=b[1],A=document.createElementNS("http://www.w3.org/2000/svg","tspan");A.setAttributeNS(null,"fill",this.themeManager.getColor(L)),A.textContent=y,(t==="up"||t==="down")&&(A.setAttributeNS(null,"x","0px"),t==="up"?A.setAttributeNS(null,"y",`-${.9*x}em`):A.setAttributeNS(null,"y",`${.9*x}em`)),h.appendChild(A)}),h.setAttributeNS(null,"data-direction",t),t==="left"||t==="right"?(h.setAttributeNS(null,"dominant-baseline","alphabetic"),h.setAttributeNS(null,"y","0.36em")):h.setAttributeNS(null,"dominant-baseline","central"),t==="left"&&h.setAttributeNS(null,"text-anchor","end"),d.appendChild(h),d.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${i}px)`);let g=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(g=this.opts.fontSizeLarge*1.1);let c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttributeNS(null,"cx",n),c.setAttributeNS(null,"cy",f),c.setAttributeNS(null,"r",g),c.setAttributeNS(null,"fill","black"),this.maskElements.push(c),this.vertices.push(d)}toCanvas(e,t,r){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=t,e.height=r,e.getContext("2d").drawImage(i,0,0,t,r)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let t="";return e.toString().split("").forEach(r=>{t+=["\u2080","\u2081","\u2082","\u2083","\u2084","\u2085","\u2086","\u2087","\u2088","\u2089"][parseInt(r)]}),t}static createUnicodeSuperscript(e){let t="";return e.toString().split("").forEach(r=>{let i=parseInt(r);Number.isFinite(i)&&(t+=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][i])}),t}static replaceNumbersWithSubscript(e){let t={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"};for(let[r,i]of Object.entries(t))e=e.replaceAll(r,i);return e}static measureText(e,t,r,i=.9){let l=document.createElement("canvas").getContext("2d");l.font=`${t}pt ${r}`;let n=l.measureText(e),f=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>f?n.width:f,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,t,r,i,s=null){e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",i);let l=new Image;return l.onload=function(){t.width=r,t.height=i;let n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(l,0,0,r,i),s&&s(t)},l.onerror=function(n){console.log(n)},l.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),t}static svgToImg(e,t,r,i){let s=document.createElement("canvas");this.svgToCanvas(e,s,r,i,l=>{t.src=s.toDataURL("image/png")})}static writeText(e,t,r,i,s=Number.MAX_SAFE_INTEGER){let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),l.appendChild(n);let f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttributeNS(null,"class","text");let h=0,d=0,g=[];return e.split(`
`).forEach(c=>{let b=M.measureText(c,r,i,1);if(b.width>=s){let x=0,y=0,L=c.split(" "),A=0;for(let H=0;H<L.length;H++){let B=M.measureText(L[H],r,i,1);x+B.width>s&&(g.push({text:L.slice(A,H).join(" "),width:x,height:y}),x=0,y=0,A=H),B.height>y&&(y=B.height),x+=B.width}A<L.length&&g.push({text:L.slice(A,L.length).join(" "),width:x,height:y})}else g.push({text:c,width:b.width,height:b.height})}),g.forEach((c,b)=>{d+=c.height;let x=document.createElementNS("http://www.w3.org/2000/svg","tspan");x.setAttributeNS(null,"fill",t.getColor("C")),x.textContent=c.text,x.setAttributeNS(null,"x","0px"),x.setAttributeNS(null,"y",`${d}px`),f.appendChild(x),c.width>h&&(h=c.width)}),l.appendChild(f),{svg:l,width:h,height:d}}};pn.exports=pi});var mn=ve((Ra,vn)=>{function Ns(M){"use strict";function e(c,b){var x=c.length,y=x===0||x>0&&x-1 in c,L=0;if(y)for(;L<x&&b.call(c[L],L,c[L])!==!1;L++);else for(L in c)if(b.call(c[L],L,c[L])===!1)break}function t(c){var b=parseInt(c).toString(16);return b.length==1?"0"+b:b}function r(c,b,x,y){return y=parseInt(y),y===void 0||y===255?"#"+t(c)+t(b)+t(x):y===0?!1:"rgba("+c+","+b+","+x+","+y/255+")"}function i(c,b,x){return"M"+c+" "+b+"h"+x}function s(c,b){return'<path stroke="'+c+'" d="'+b+`" />
`}function l(c){var b="";return e(c,function(x,y){var L=x;if(x=r.apply(null,x.split(",")),x!==!1){var A=[],H,B=1;e(y,function(){H&&this[1]===H[1]&&this[0]===H[0]+B?B++:(H&&(A.push(i(H[0],H[1],B)),B=1),H=this)}),A.push(i(H[0],H[1],B)),b+=s(x,A.join(""))}}),b}var n=function(c){for(var b={},x=c.data,y=x.length,L=c.width,A=c.height,H=0,B=0,k=0,$;k<y;k+=4)x[k+3]>0&&($=x[k]+","+x[k+1]+","+x[k+2]+","+x[k+3],b[$]=b[$]||[],H=k/4%L,B=Math.floor(k/4/L),b[$].push([H,B]));return b};let f=n(M),h=l(f),d='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+M.width+" "+M.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+h+"</g></svg>";var g=document.createElement("div");return g.innerHTML=d,g.firstChild}vn.exports=Ns});var bn=ve((vi,mi)=>{(function(M,e){typeof vi=="object"&&typeof mi!="undefined"?mi.exports=e():typeof define=="function"&&define.amd?define(e):(M=typeof globalThis!="undefined"?globalThis:M||self,M.chroma=e())})(vi,function(){"use strict";function M(a,o,u){return o===void 0&&(o=0),u===void 0&&(u=1),d(g(o,a),u)}function e(a){a._clipped=!1,a._unclipped=a.slice(0);for(var o=0;o<=3;o++)o<3?((a[o]<0||a[o]>255)&&(a._clipped=!0),a[o]=M(a[o],0,255)):o===3&&(a[o]=M(a[o],0,1));return a}for(var t={},r=0,i=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];r<i.length;r+=1){var s=i[r];t["[object "+s+"]"]=s.toLowerCase()}function l(a){return t[Object.prototype.toString.call(a)]||"object"}function n(a,o){return o===void 0&&(o=null),a.length>=3?Array.prototype.slice.call(a):l(a[0])=="object"&&o?o.split("").filter(function(u){return a[0][u]!==void 0}).map(function(u){return a[0][u]}):a[0]}function f(a){if(a.length<2)return null;var o=a.length-1;return l(a[o])=="string"?a[o].toLowerCase():null}var h=Math.PI,d=Math.min,g=Math.max,c=h*2,b=h/3,x=h/180,y=180/h,L={format:{},autodetect:[]},A=function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];var p=this;if(l(o[0])==="object"&&o[0].constructor&&o[0].constructor===this.constructor)return o[0];var S=f(o),C=!1;if(!S){C=!0,L.sorted||(L.autodetect=L.autodetect.sort(function(D,W){return W.p-D.p}),L.sorted=!0);for(var w=0,E=L.autodetect;w<E.length;w+=1){var T=E[w];if(S=T.test.apply(T,o),S)break}}if(L.format[S]){var P=L.format[S].apply(null,C?o:o.slice(0,-1));p._rgb=e(P)}else throw new Error("unknown format: "+o);p._rgb.length===3&&p._rgb.push(1)};A.prototype.toString=function(){return l(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var H="2.6.0",B=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(B.Color,[null].concat(a)))};B.Color=A,B.version=H;var k=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"cmyk");var u=a[0],p=a[1],S=a[2],C=a[3],w=a.length>4?a[4]:1;return C===1?[0,0,0,w]:[u>=1?0:255*(1-u)*(1-C),p>=1?0:255*(1-p)*(1-C),S>=1?0:255*(1-S)*(1-C),w]},$=Math.max,J=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2];p=p/255,S=S/255,C=C/255;var w=1-$(p,$(S,C)),E=w<1?1/(1-w):0,T=(1-p-w)*E,P=(1-S-w)*E,D=(1-C-w)*E;return[T,P,D,w]};A.prototype.cmyk=function(){return J(this._rgb)},B.cmyk=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["cmyk"])))},L.format.cmyk=k,L.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"cmyk"),l(a)==="array"&&a.length===4)return"cmyk"}});var Q=function(a){return Math.round(a*100)/100},ue=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"hsla"),p=f(a)||"lsa";return u[0]=Q(u[0]||0),u[1]=Q(u[1]*100)+"%",u[2]=Q(u[2]*100)+"%",p==="hsla"||u.length>3&&u[3]<1?(u[3]=u.length>3?u[3]:1,p="hsla"):u.length=3,p+"("+u.join(",")+")"},ne=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"rgba");var u=a[0],p=a[1],S=a[2];u/=255,p/=255,S/=255;var C=d(u,p,S),w=g(u,p,S),E=(w+C)/2,T,P;return w===C?(T=0,P=Number.NaN):T=E<.5?(w-C)/(w+C):(w-C)/(2-w-C),u==w?P=(p-S)/(w-C):p==w?P=2+(S-u)/(w-C):S==w&&(P=4+(u-p)/(w-C)),P*=60,P<0&&(P+=360),a.length>3&&a[3]!==void 0?[P,T,E,a[3]]:[P,T,E]},j=Math.round,ee=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgba"),p=f(a)||"rgb";return p.substr(0,3)=="hsl"?ue(ne(u),p):(u[0]=j(u[0]),u[1]=j(u[1]),u[2]=j(u[2]),(p==="rgba"||u.length>3&&u[3]<1)&&(u[3]=u.length>3?u[3]:1,p="rgba"),p+"("+u.slice(0,p==="rgb"?3:4).join(",")+")")},me=Math.round,fe=function(){for(var a,o=[],u=arguments.length;u--;)o[u]=arguments[u];o=n(o,"hsl");var p=o[0],S=o[1],C=o[2],w,E,T;if(S===0)w=E=T=C*255;else{var P=[0,0,0],D=[0,0,0],W=C<.5?C*(1+S):C+S-C*S,z=2*C-W,_=p/360;P[0]=_+1/3,P[1]=_,P[2]=_-1/3;for(var X=0;X<3;X++)P[X]<0&&(P[X]+=1),P[X]>1&&(P[X]-=1),6*P[X]<1?D[X]=z+(W-z)*6*P[X]:2*P[X]<1?D[X]=W:3*P[X]<2?D[X]=z+(W-z)*(2/3-P[X])*6:D[X]=z;a=[me(D[0]*255),me(D[1]*255),me(D[2]*255)],w=a[0],E=a[1],T=a[2]}return o.length>3?[w,E,T,o[3]]:[w,E,T,1]},xe=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,We=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,He=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Ke=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Je=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,lt=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ae=Math.round,Se=function(a){a=a.toLowerCase().trim();var o;if(L.format.named)try{return L.format.named(a)}catch(X){}if(o=a.match(xe)){for(var u=o.slice(1,4),p=0;p<3;p++)u[p]=+u[p];return u[3]=1,u}if(o=a.match(We)){for(var S=o.slice(1,5),C=0;C<4;C++)S[C]=+S[C];return S}if(o=a.match(He)){for(var w=o.slice(1,4),E=0;E<3;E++)w[E]=Ae(w[E]*2.55);return w[3]=1,w}if(o=a.match(Ke)){for(var T=o.slice(1,5),P=0;P<3;P++)T[P]=Ae(T[P]*2.55);return T[3]=+T[3],T}if(o=a.match(Je)){var D=o.slice(1,4);D[1]*=.01,D[2]*=.01;var W=fe(D);return W[3]=1,W}if(o=a.match(lt)){var z=o.slice(1,4);z[1]*=.01,z[2]*=.01;var _=fe(z);return _[3]=+o[4],_}};Se.test=function(a){return xe.test(a)||We.test(a)||He.test(a)||Ke.test(a)||Je.test(a)||lt.test(a)},A.prototype.css=function(a){return ee(this._rgb,a)},B.css=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["css"])))},L.format.css=Se,L.autodetect.push({p:5,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&l(a)==="string"&&Se.test(a))return"css"}}),L.format.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgba");return u[0]*=255,u[1]*=255,u[2]*=255,u},B.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["gl"])))},A.prototype.gl=function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var St=Math.floor,At=function(){for(var a,o,u,p,S,C,w=[],E=arguments.length;E--;)w[E]=arguments[E];w=n(w,"hcg");var T=w[0],P=w[1],D=w[2],W,z,_;D=D*255;var X=P*255;if(P===0)W=z=_=D;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var re=St(T),ae=T-re,oe=D*(1-P),ge=oe+X*(1-ae),Oe=oe+X*ae,Pe=oe+X;switch(re){case 0:a=[Pe,Oe,oe],W=a[0],z=a[1],_=a[2];break;case 1:o=[ge,Pe,oe],W=o[0],z=o[1],_=o[2];break;case 2:u=[oe,Pe,Oe],W=u[0],z=u[1],_=u[2];break;case 3:p=[oe,ge,Pe],W=p[0],z=p[1],_=p[2];break;case 4:S=[Oe,oe,Pe],W=S[0],z=S[1],_=S[2];break;case 5:C=[Pe,oe,ge],W=C[0],z=C[1],_=C[2];break}}return[W,z,_,w.length>3?w[3]:1]},Ct=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2],w=d(p,S,C),E=g(p,S,C),T=E-w,P=T*100/255,D=w/(255-T)*100,W;return T===0?W=Number.NaN:(p===E&&(W=(S-C)/T),S===E&&(W=2+(C-p)/T),C===E&&(W=4+(p-S)/T),W*=60,W<0&&(W+=360)),[W,P,D]};A.prototype.hcg=function(){return Ct(this._rgb)},B.hcg=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hcg"])))},L.format.hcg=At,L.autodetect.push({p:1,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"hcg"),l(a)==="array"&&a.length===3)return"hcg"}});var It=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,xt=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,U=function(a){if(a.match(It)){(a.length===4||a.length===7)&&(a=a.substr(1)),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var o=parseInt(a,16),u=o>>16,p=o>>8&255,S=o&255;return[u,p,S,1]}if(a.match(xt)){(a.length===5||a.length===9)&&(a=a.substr(1)),a.length===4&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);var C=parseInt(a,16),w=C>>24&255,E=C>>16&255,T=C>>8&255,P=Math.round((C&255)/255*100)/100;return[w,E,T,P]}throw new Error("unknown hex color: "+a)},Ne=Math.round,Qe=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgba"),p=u[0],S=u[1],C=u[2],w=u[3],E=f(a)||"auto";w===void 0&&(w=1),E==="auto"&&(E=w<1?"rgba":"rgb"),p=Ne(p),S=Ne(S),C=Ne(C);var T=p<<16|S<<8|C,P="000000"+T.toString(16);P=P.substr(P.length-6);var D="0"+Ne(w*255).toString(16);switch(D=D.substr(D.length-2),E.toLowerCase()){case"rgba":return"#"+P+D;case"argb":return"#"+D+P;default:return"#"+P}};A.prototype.hex=function(a){return Qe(this._rgb,a)},B.hex=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hex"])))},L.format.hex=U,L.autodetect.push({p:4,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&l(a)==="string"&&[3,4,5,6,7,8,9].indexOf(a.length)>=0)return"hex"}});var Be=Math.cos,et=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"hsi");var u=a[0],p=a[1],S=a[2],C,w,E;return isNaN(u)&&(u=0),isNaN(p)&&(p=0),u>360&&(u-=360),u<0&&(u+=360),u/=360,u<1/3?(E=(1-p)/3,C=(1+p*Be(c*u)/Be(b-c*u))/3,w=1-(E+C)):u<2/3?(u-=1/3,C=(1-p)/3,w=(1+p*Be(c*u)/Be(b-c*u))/3,E=1-(C+w)):(u-=2/3,w=(1-p)/3,E=(1+p*Be(c*u)/Be(b-c*u))/3,C=1-(w+E)),C=M(S*C*3),w=M(S*w*3),E=M(S*E*3),[C*255,w*255,E*255,a.length>3?a[3]:1]},Ge=Math.min,Xe=Math.sqrt,_e=Math.acos,Nt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2];p/=255,S/=255,C/=255;var w,E=Ge(p,S,C),T=(p+S+C)/3,P=T>0?1-E/T:0;return P===0?w=NaN:(w=(p-S+(p-C))/2,w/=Xe((p-S)*(p-S)+(p-C)*(S-C)),w=_e(w),C>S&&(w=c-w),w/=c),[w*360,P,T]};A.prototype.hsi=function(){return Nt(this._rgb)},B.hsi=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hsi"])))},L.format.hsi=et,L.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"hsi"),l(a)==="array"&&a.length===3)return"hsi"}}),A.prototype.hsl=function(){return ne(this._rgb)},B.hsl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hsl"])))},L.format.hsl=fe,L.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"hsl"),l(a)==="array"&&a.length===3)return"hsl"}});var Ze=Math.floor,Ie=function(){for(var a,o,u,p,S,C,w=[],E=arguments.length;E--;)w[E]=arguments[E];w=n(w,"hsv");var T=w[0],P=w[1],D=w[2],W,z,_;if(D*=255,P===0)W=z=_=D;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var X=Ze(T),re=T-X,ae=D*(1-P),oe=D*(1-P*re),ge=D*(1-P*(1-re));switch(X){case 0:a=[D,ge,ae],W=a[0],z=a[1],_=a[2];break;case 1:o=[oe,D,ae],W=o[0],z=o[1],_=o[2];break;case 2:u=[ae,D,ge],W=u[0],z=u[1],_=u[2];break;case 3:p=[ae,oe,D],W=p[0],z=p[1],_=p[2];break;case 4:S=[ge,ae,D],W=S[0],z=S[1],_=S[2];break;case 5:C=[D,ae,oe],W=C[0],z=C[1],_=C[2];break}}return[W,z,_,w.length>3?w[3]:1]},Le=Math.min,ke=Math.max,ot=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"rgb");var u=a[0],p=a[1],S=a[2],C=Le(u,p,S),w=ke(u,p,S),E=w-C,T,P,D;return D=w/255,w===0?(T=Number.NaN,P=0):(P=E/w,u===w&&(T=(p-S)/E),p===w&&(T=2+(S-u)/E),S===w&&(T=4+(u-p)/E),T*=60,T<0&&(T+=360)),[T,P,D]};A.prototype.hsv=function(){return ot(this._rgb)},B.hsv=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hsv"])))},L.format.hsv=Ie,L.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"hsv"),l(a)==="array"&&a.length===3)return"hsv"}});var ye={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Rt=Math.pow,pt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"lab");var u=a[0],p=a[1],S=a[2],C,w,E,T,P,D;return w=(u+16)/116,C=isNaN(p)?w:w+p/500,E=isNaN(S)?w:w-S/200,w=ye.Yn*nt(w),C=ye.Xn*nt(C),E=ye.Zn*nt(E),T=ht(3.2404542*C-1.5371385*w-.4985314*E),P=ht(-.969266*C+1.8760108*w+.041556*E),D=ht(.0556434*C-.2040259*w+1.0572252*E),[T,P,D,a.length>3?a[3]:1]},ht=function(a){return 255*(a<=.00304?12.92*a:1.055*Rt(a,1/2.4)-.055)},nt=function(a){return a>ye.t1?a*a*a:ye.t2*(a-ye.t0)},tt=Math.pow,ut=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2],w=Et(p,S,C),E=w[0],T=w[1],P=w[2],D=116*T-16;return[D<0?0:D,500*(E-T),200*(T-P)]},gt=function(a){return(a/=255)<=.04045?a/12.92:tt((a+.055)/1.055,2.4)},ft=function(a){return a>ye.t3?tt(a,1/3):a/ye.t2+ye.t0},Et=function(a,o,u){a=gt(a),o=gt(o),u=gt(u);var p=ft((.4124564*a+.3575761*o+.1804375*u)/ye.Xn),S=ft((.2126729*a+.7151522*o+.072175*u)/ye.Yn),C=ft((.0193339*a+.119192*o+.9503041*u)/ye.Zn);return[p,S,C]};A.prototype.lab=function(){return ut(this._rgb)},B.lab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["lab"])))},L.format.lab=pt,L.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"lab"),l(a)==="array"&&a.length===3)return"lab"}});var Br=Math.sin,Pr=Math.cos,Kt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"lch"),p=u[0],S=u[1],C=u[2];return isNaN(C)&&(C=0),C=C*x,[p,Pr(C)*S,Br(C)*S]},ur=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"lch");var u=a[0],p=a[1],S=a[2],C=Kt(u,p,S),w=C[0],E=C[1],T=C[2],P=pt(w,E,T),D=P[0],W=P[1],z=P[2];return[D,W,z,a.length>3?a[3]:1]},gr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"hcl").reverse();return ur.apply(void 0,u)},Ir=Math.sqrt,kr=Math.atan2,Or=Math.round,Jt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"lab"),p=u[0],S=u[1],C=u[2],w=Ir(S*S+C*C),E=(kr(C,S)*y+360)%360;return Or(w*1e4)===0&&(E=Number.NaN),[p,w,E]},Qt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2],w=ut(p,S,C),E=w[0],T=w[1],P=w[2];return Jt(E,T,P)};A.prototype.lch=function(){return Qt(this._rgb)},A.prototype.hcl=function(){return Qt(this._rgb).reverse()},B.lch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["lch"])))},B.hcl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["hcl"])))},L.format.lch=ur,L.format.hcl=gr,["lch","hcl"].forEach(function(a){return L.autodetect.push({p:2,test:function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(o=n(o,a),l(o)==="array"&&o.length===3)return a}})});var vt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};A.prototype.name=function(){for(var a=Qe(this._rgb,"rgb"),o=0,u=Object.keys(vt);o<u.length;o+=1){var p=u[o];if(vt[p]===a)return p.toLowerCase()}return a},L.format.named=function(a){if(a=a.toLowerCase(),vt[a])return U(vt[a]);throw new Error("unknown color name: "+a)},L.autodetect.push({p:5,test:function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];if(!o.length&&l(a)==="string"&&vt[a.toLowerCase()])return"named"}});var fr=function(a){if(l(a)=="number"&&a>=0&&a<=16777215){var o=a>>16,u=a>>8&255,p=a&255;return[o,u,p,1]}throw new Error("unknown num color: "+a)},cr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2];return(p<<16)+(S<<8)+C};A.prototype.num=function(){return cr(this._rgb)},B.num=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["num"])))},L.format.num=fr,L.autodetect.push({p:5,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a.length===1&&l(a[0])==="number"&&a[0]>=0&&a[0]<=16777215)return"num"}});var dr=Math.round;A.prototype.rgb=function(a){return a===void 0&&(a=!0),a===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(dr)},A.prototype.rgba=function(a){return a===void 0&&(a=!0),this._rgb.slice(0,4).map(function(o,u){return u<3?a===!1?o:dr(o):o})},B.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["rgb"])))},L.format.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgba");return u[3]===void 0&&(u[3]=1),u},L.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"rgba"),l(a)==="array"&&(a.length===3||a.length===4&&l(a[3])=="number"&&a[3]>=0&&a[3]<=1))return"rgb"}});var kt=Math.log,pr=function(a){var o=a/100,u,p,S;return o<66?(u=255,p=o<6?0:-155.25485562709179-.44596950469579133*(p=o-2)+104.49216199393888*kt(p),S=o<20?0:-254.76935184120902+.8274096064007395*(S=o-10)+115.67994401066147*kt(S)):(u=351.97690566805693+.114206453784165*(u=o-55)-40.25366309332127*kt(u),p=325.4494125711974+.07943456536662342*(p=o-50)-28.0852963507957*kt(p),S=255),[u,p,S,1]},Dr=Math.round,$r=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];for(var u=n(a,"rgb"),p=u[0],S=u[2],C=1e3,w=4e4,E=.4,T;w-C>E;){T=(w+C)*.5;var P=pr(T);P[2]/P[0]>=S/p?w=T:C=T}return Dr(T)};A.prototype.temp=A.prototype.kelvin=A.prototype.temperature=function(){return $r(this._rgb)},B.temp=B.kelvin=B.temperature=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["temp"])))},L.format.temp=L.format.kelvin=L.format.temperature=pr;var Ot=Math.pow,Hr=Math.sign,vr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"lab");var u=a[0],p=a[1],S=a[2],C=Ot(u+.3963377774*p+.2158037573*S,3),w=Ot(u-.1055613458*p-.0638541728*S,3),E=Ot(u-.0894841775*p-1.291485548*S,3);return[255*jt(4.0767416621*C-3.3077115913*w+.2309699292*E),255*jt(-1.2684380046*C+2.6097574011*w-.3413193965*E),255*jt(-.0041960863*C-.7034186147*w+1.707614701*E),a.length>3?a[3]:1]};function jt(a){var o=Math.abs(a);return o>.0031308?(Hr(a)||1)*(1.055*Ot(o,1/2.4)-.055):a*12.92}var er=Math.cbrt,m=Math.pow,we=Math.sign,Tt=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2],w=[Ve(p/255),Ve(S/255),Ve(C/255)],E=w[0],T=w[1],P=w[2],D=er(.4122214708*E+.5363325363*T+.0514459929*P),W=er(.2119034982*E+.6806995451*T+.1073969566*P),z=er(.0883024619*E+.2817188376*T+.6299787005*P);return[.2104542553*D+.793617785*W-.0040720468*z,1.9779984951*D-2.428592205*W+.4505937099*z,.0259040371*D+.7827717662*W-.808675766*z]};function Ve(a){var o=Math.abs(a);return o<.04045?a/12.92:(we(a)||1)*m((o+.055)/1.055,2.4)}A.prototype.oklab=function(){return Tt(this._rgb)},B.oklab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["oklab"])))},L.format.oklab=vr,L.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"oklab"),l(a)==="array"&&a.length===3)return"oklab"}});var tr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=n(a,"lch");var u=a[0],p=a[1],S=a[2],C=Kt(u,p,S),w=C[0],E=C[1],T=C[2],P=vr(w,E,T),D=P[0],W=P[1],z=P[2];return[D,W,z,a.length>3?a[3]:1]},Y=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var u=n(a,"rgb"),p=u[0],S=u[1],C=u[2],w=Tt(p,S,C),E=w[0],T=w[1],P=w[2];return Jt(E,T,P)};A.prototype.oklch=function(){return Y(this._rgb)},B.oklch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(a,["oklch"])))},L.format.oklch=tr,L.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=n(a,"oklch"),l(a)==="array"&&a.length===3)return"oklch"}}),A.prototype.alpha=function(a,o){return o===void 0&&(o=!1),a!==void 0&&l(a)==="number"?o?(this._rgb[3]=a,this):new A([this._rgb[0],this._rgb[1],this._rgb[2],a],"rgb"):this._rgb[3]},A.prototype.clipped=function(){return this._rgb._clipped||!1},A.prototype.darken=function(a){a===void 0&&(a=1);var o=this,u=o.lab();return u[0]-=ye.Kn*a,new A(u,"lab").alpha(o.alpha(),!0)},A.prototype.brighten=function(a){return a===void 0&&(a=1),this.darken(-a)},A.prototype.darker=A.prototype.darken,A.prototype.brighter=A.prototype.brighten,A.prototype.get=function(a){var o=a.split("."),u=o[0],p=o[1],S=this[u]();if(p){var C=u.indexOf(p)-(u.substr(0,2)==="ok"?2:0);if(C>-1)return S[C];throw new Error("unknown channel "+p+" in mode "+u)}else return S};var Dt=Math.pow,Bi=1e-7,Pi=20;A.prototype.luminance=function(a,o){if(o===void 0&&(o="rgb"),a!==void 0&&l(a)==="number"){if(a===0)return new A([0,0,0,this._rgb[3]],"rgb");if(a===1)return new A([255,255,255,this._rgb[3]],"rgb");var u=this.luminance(),p=Pi,S=function(w,E){var T=w.interpolate(E,.5,o),P=T.luminance();return Math.abs(a-P)<Bi||!p--?T:P>a?S(w,T):S(T,E)},C=(u>a?S(new A([0,0,0]),this):S(this,new A([255,255,255]))).rgb();return new A(C.concat([this._rgb[3]]))}return Ii.apply(void 0,this._rgb.slice(0,3))};var Ii=function(a,o,u){return a=mr(a),o=mr(o),u=mr(u),.2126*a+.7152*o+.0722*u},mr=function(a){return a/=255,a<=.03928?a/12.92:Dt((a+.055)/1.055,2.4)},te={};function $e(a,o,u){u===void 0&&(u=.5);for(var p=[],S=arguments.length-3;S-- >0;)p[S]=arguments[S+3];var C=p[0]||"lrgb";if(!te[C]&&!p.length&&(C=Object.keys(te)[0]),!te[C])throw new Error("interpolation mode "+C+" is not defined");return l(a)!=="object"&&(a=new A(a)),l(o)!=="object"&&(o=new A(o)),te[C](a,o,u).alpha(a.alpha()+u*(o.alpha()-a.alpha()))}A.prototype.mix=A.prototype.interpolate=function(a,o){o===void 0&&(o=.5);for(var u=[],p=arguments.length-2;p-- >0;)u[p]=arguments[p+2];return $e.apply(void 0,[this,a,o].concat(u))},A.prototype.premultiply=function(a){a===void 0&&(a=!1);var o=this._rgb,u=o[3];return a?(this._rgb=[o[0]*u,o[1]*u,o[2]*u,u],this):new A([o[0]*u,o[1]*u,o[2]*u,u],"rgb")},A.prototype.saturate=function(a){a===void 0&&(a=1);var o=this,u=o.lch();return u[1]+=ye.Kn*a,u[1]<0&&(u[1]=0),new A(u,"lch").alpha(o.alpha(),!0)},A.prototype.desaturate=function(a){return a===void 0&&(a=1),this.saturate(-a)},A.prototype.set=function(a,o,u){u===void 0&&(u=!1);var p=a.split("."),S=p[0],C=p[1],w=this[S]();if(C){var E=S.indexOf(C)-(S.substr(0,2)==="ok"?2:0);if(E>-1){if(l(o)=="string")switch(o.charAt(0)){case"+":w[E]+=+o;break;case"-":w[E]+=+o;break;case"*":w[E]*=+o.substr(1);break;case"/":w[E]/=+o.substr(1);break;default:w[E]=+o}else if(l(o)==="number")w[E]=o;else throw new Error("unsupported value for Color.set");var T=new A(w,S);return u?(this._rgb=T._rgb,this):T}throw new Error("unknown channel "+C+" in mode "+S)}else return w},A.prototype.tint=function(a){a===void 0&&(a=.5);for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];return $e.apply(void 0,[this,"white",a].concat(o))},A.prototype.shade=function(a){a===void 0&&(a=.5);for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];return $e.apply(void 0,[this,"black",a].concat(o))};var ki=function(a,o,u){var p=a._rgb,S=o._rgb;return new A(p[0]+u*(S[0]-p[0]),p[1]+u*(S[1]-p[1]),p[2]+u*(S[2]-p[2]),"rgb")};te.rgb=ki;var rr=Math.sqrt,mt=Math.pow,br=function(a,o,u){var p=a._rgb,S=p[0],C=p[1],w=p[2],E=o._rgb,T=E[0],P=E[1],D=E[2];return new A(rr(mt(S,2)*(1-u)+mt(T,2)*u),rr(mt(C,2)*(1-u)+mt(P,2)*u),rr(mt(w,2)*(1-u)+mt(D,2)*u),"rgb")};te.lrgb=br;var Lt=function(a,o,u){var p=a.lab(),S=o.lab();return new A(p[0]+u*(S[0]-p[0]),p[1]+u*(S[1]-p[1]),p[2]+u*(S[2]-p[2]),"lab")};te.lab=Lt;function V(a,o,u,p){var S,C,w,E;p==="hsl"?(w=a.hsl(),E=o.hsl()):p==="hsv"?(w=a.hsv(),E=o.hsv()):p==="hcg"?(w=a.hcg(),E=o.hcg()):p==="hsi"?(w=a.hsi(),E=o.hsi()):p==="lch"||p==="hcl"?(p="hcl",w=a.hcl(),E=o.hcl()):p==="oklch"&&(w=a.oklch().reverse(),E=o.oklch().reverse());var T,P,D,W,z,_;(p.substr(0,1)==="h"||p==="oklch")&&(S=w,T=S[0],D=S[1],z=S[2],C=E,P=C[0],W=C[1],_=C[2]);var X,re,ae,oe;return!isNaN(T)&&!isNaN(P)?(P>T&&P-T>180?oe=P-(T+360):P<T&&T-P>180?oe=P+360-T:oe=P-T,re=T+u*oe):isNaN(T)?isNaN(P)?re=Number.NaN:(re=P,(z==1||z==0)&&p!="hsv"&&(X=W)):(re=T,(_==1||_==0)&&p!="hsv"&&(X=D)),X===void 0&&(X=D+u*(W-D)),ae=z+u*(_-z),p==="oklch"?new A([ae,X,re],p):new A([re,X,ae],p)}var $t=function(a,o,u){return V(a,o,u,"lch")};te.lch=$t,te.hcl=$t;var wr=function(a,o,u){var p=a.num(),S=o.num();return new A(p+u*(S-p),"num")};te.num=wr;var Ht=function(a,o,u){return V(a,o,u,"hcg")};te.hcg=Ht;var bt=function(a,o,u){return V(a,o,u,"hsi")};te.hsi=bt;var zr=function(a,o,u){return V(a,o,u,"hsl")};te.hsl=zr;var zt=function(a,o,u){return V(a,o,u,"hsv")};te.hsv=zt;var qr=function(a,o,u){var p=a.oklab(),S=o.oklab();return new A(p[0]+u*(S[0]-p[0]),p[1]+u*(S[1]-p[1]),p[2]+u*(S[2]-p[2]),"oklab")};te.oklab=qr;var Fr=function(a,o,u){return V(a,o,u,"oklch")};te.oklch=Fr;var qt=Math.pow,Ft=Math.sqrt,ir=Math.PI,nr=Math.cos,yr=Math.sin,Wr=Math.atan2;function Xr(a,o,u){o===void 0&&(o="lrgb"),u===void 0&&(u=null);var p=a.length;u||(u=Array.from(new Array(p)).map(function(){return 1}));var S=p/u.reduce(function(re,ae){return re+ae});if(u.forEach(function(re,ae){u[ae]*=S}),a=a.map(function(re){return new A(re)}),o==="lrgb")return _r(a,u);for(var C=a.shift(),w=C.get(o),E=[],T=0,P=0,D=0;D<w.length;D++)if(w[D]=(w[D]||0)*u[0],E.push(isNaN(w[D])?0:u[0]),o.charAt(D)==="h"&&!isNaN(w[D])){var W=w[D]/180*ir;T+=nr(W)*u[0],P+=yr(W)*u[0]}var z=C.alpha()*u[0];a.forEach(function(re,ae){var oe=re.get(o);z+=re.alpha()*u[ae+1];for(var ge=0;ge<w.length;ge++)if(!isNaN(oe[ge]))if(E[ge]+=u[ae+1],o.charAt(ge)==="h"){var Oe=oe[ge]/180*ir;T+=nr(Oe)*u[ae+1],P+=yr(Oe)*u[ae+1]}else w[ge]+=oe[ge]*u[ae+1]});for(var _=0;_<w.length;_++)if(o.charAt(_)==="h"){for(var X=Wr(P/E[_],T/E[_])/ir*180;X<0;)X+=360;for(;X>=360;)X-=360;w[_]=X}else w[_]=w[_]/E[_];return z/=p,new A(w,o).alpha(z>.99999?1:z,!0)}var _r=function(a,o){for(var u=a.length,p=[0,0,0,0],S=0;S<a.length;S++){var C=a[S],w=o[S]/u,E=C._rgb;p[0]+=qt(E[0],2)*w,p[1]+=qt(E[1],2)*w,p[2]+=qt(E[2],2)*w,p[3]+=E[3]*w}return p[0]=Ft(p[0]),p[1]=Ft(p[1]),p[2]=Ft(p[2]),p[3]>.9999999&&(p[3]=1),new A(e(p))},Vr=Math.pow;function Wt(a){var o="rgb",u=B("#ccc"),p=0,S=[0,1],C=[],w=[0,0],E=!1,T=[],P=!1,D=0,W=1,z=!1,_={},X=!0,re=1,ae=function(q){if(q=q||["#fff","#000"],q&&l(q)==="string"&&B.brewer&&B.brewer[q.toLowerCase()]&&(q=B.brewer[q.toLowerCase()]),l(q)==="array"){q.length===1&&(q=[q[0],q[0]]),q=q.slice(0);for(var Z=0;Z<q.length;Z++)q[Z]=B(q[Z]);C.length=0;for(var se=0;se<q.length;se++)C.push(se/(q.length-1))}return Ye(),T=q},oe=function(q){if(E!=null){for(var Z=E.length-1,se=0;se<Z&&q>=E[se];)se++;return se-1}return 0},ge=function(q){return q},Oe=function(q){return q},Pe=function(q,Z){var se,ie;if(Z==null&&(Z=!1),isNaN(q)||q===null)return u;if(Z)ie=q;else if(E&&E.length>2){var De=oe(q);ie=De/(E.length-2)}else W!==D?ie=(q-D)/(W-D):ie=1;ie=Oe(ie),Z||(ie=ge(ie)),re!==1&&(ie=Vr(ie,re)),ie=w[0]+ie*(1-w[0]-w[1]),ie=M(ie,0,1);var be=Math.floor(ie*1e4);if(X&&_[be])se=_[be];else{if(l(T)==="array")for(var he=0;he<C.length;he++){var ce=C[he];if(ie<=ce){se=T[he];break}if(ie>=ce&&he===C.length-1){se=T[he];break}if(ie>ce&&ie<C[he+1]){ie=(ie-ce)/(C[he+1]-ce),se=B.interpolate(T[he],T[he+1],ie,o);break}}else l(T)==="function"&&(se=T(ie));X&&(_[be]=se)}return se},Ye=function(){return _={}};ae(a);var le=function(q){var Z=B(Pe(q));return P&&Z[P]?Z[P]():Z};return le.classes=function(q){if(q!=null){if(l(q)==="array")E=q,S=[q[0],q[q.length-1]];else{var Z=B.analyze(S);q===0?E=[Z.min,Z.max]:E=B.limits(Z,"e",q)}return le}return E},le.domain=function(q){if(!arguments.length)return S;D=q[0],W=q[q.length-1],C=[];var Z=T.length;if(q.length===Z&&D!==W)for(var se=0,ie=Array.from(q);se<ie.length;se+=1){var De=ie[se];C.push((De-D)/(W-D))}else{for(var be=0;be<Z;be++)C.push(be/(Z-1));if(q.length>2){var he=q.map(function(de,pe){return pe/(q.length-1)}),ce=q.map(function(de){return(de-D)/(W-D)});ce.every(function(de,pe){return he[pe]===de})||(Oe=function(de){if(de<=0||de>=1)return de;for(var pe=0;de>=ce[pe+1];)pe++;var it=(de-ce[pe])/(ce[pe+1]-ce[pe]),wt=he[pe]+it*(he[pe+1]-he[pe]);return wt})}}return S=[D,W],le},le.mode=function(q){return arguments.length?(o=q,Ye(),le):o},le.range=function(q,Z){return ae(q),le},le.out=function(q){return P=q,le},le.spread=function(q){return arguments.length?(p=q,le):p},le.correctLightness=function(q){return q==null&&(q=!0),z=q,Ye(),z?ge=function(Z){for(var se=Pe(0,!0).lab()[0],ie=Pe(1,!0).lab()[0],De=se>ie,be=Pe(Z,!0).lab()[0],he=se+(ie-se)*Z,ce=be-he,de=0,pe=1,it=20;Math.abs(ce)>.01&&it-- >0;)(function(){return De&&(ce*=-1),ce<0?(de=Z,Z+=(pe-Z)*.5):(pe=Z,Z+=(de-Z)*.5),be=Pe(Z,!0).lab()[0],ce=be-he})();return Z}:ge=function(Z){return Z},le},le.padding=function(q){return q!=null?(l(q)==="number"&&(q=[q,q]),w=q,le):w},le.colors=function(q,Z){arguments.length<2&&(Z="hex");var se=[];if(arguments.length===0)se=T.slice(0);else if(q===1)se=[le(.5)];else if(q>1){var ie=S[0],De=S[1]-ie;se=Yr(0,q).map(function(pe){return le(ie+pe/(q-1)*De)})}else{a=[];var be=[];if(E&&E.length>2)for(var he=1,ce=E.length,de=1<=ce;de?he<ce:he>ce;de?he++:he--)be.push((E[he-1]+E[he])*.5);else be=S;se=be.map(function(pe){return le(pe)})}return B[Z]&&(se=se.map(function(pe){return pe[Z]()})),se},le.cache=function(q){return q!=null?(X=q,le):X},le.gamma=function(q){return q!=null?(re=q,le):re},le.nodata=function(q){return q!=null?(u=B(q),le):u},le}function Yr(a,o,u){for(var p=[],S=a<o,C=o,w=a;S?w<C:w>C;S?w++:w--)p.push(w);return p}var N=function(a){for(var o=[1,1],u=1;u<a;u++){for(var p=[1],S=1;S<=o.length;S++)p[S]=(o[S]||0)+o[S-1];o=p}return o},v=function(a){var o,u,p,S,C,w,E;if(a=a.map(function(z){return new A(z)}),a.length===2)o=a.map(function(z){return z.lab()}),C=o[0],w=o[1],S=function(z){var _=[0,1,2].map(function(X){return C[X]+z*(w[X]-C[X])});return new A(_,"lab")};else if(a.length===3)u=a.map(function(z){return z.lab()}),C=u[0],w=u[1],E=u[2],S=function(z){var _=[0,1,2].map(function(X){return(1-z)*(1-z)*C[X]+2*(1-z)*z*w[X]+z*z*E[X]});return new A(_,"lab")};else if(a.length===4){var T;p=a.map(function(z){return z.lab()}),C=p[0],w=p[1],E=p[2],T=p[3],S=function(z){var _=[0,1,2].map(function(X){return(1-z)*(1-z)*(1-z)*C[X]+3*(1-z)*(1-z)*z*w[X]+3*(1-z)*z*z*E[X]+z*z*z*T[X]});return new A(_,"lab")}}else if(a.length>=5){var P,D,W;P=a.map(function(z){return z.lab()}),W=a.length-1,D=N(W),S=function(z){var _=1-z,X=[0,1,2].map(function(re){return P.reduce(function(ae,oe,ge){return ae+D[ge]*Math.pow(_,W-ge)*Math.pow(z,ge)*oe[re]},0)});return new A(X,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return S};function I(a){var o=v(a);return o.scale=function(){return Wt(o)},o}var R=function(a,o,u){if(!R[u])throw new Error("unknown blend mode "+u);return R[u](a,o)},O=function(a){return function(o,u){var p=B(u).rgb(),S=B(o).rgb();return B.rgb(a(p,S))}},F=function(a){return function(o,u){var p=[];return p[0]=a(o[0],u[0]),p[1]=a(o[1],u[1]),p[2]=a(o[2],u[2]),p}},G=function(a){return a},Me=function(a,o){return a*o/255},je=function(a,o){return a>o?o:a},rt=function(a,o){return a>o?a:o},qn=function(a,o){return 255*(1-(1-a/255)*(1-o/255))},Fn=function(a,o){return o<128?2*a*o/255:255*(1-2*(1-a/255)*(1-o/255))},Wn=function(a,o){return 255*(1-(1-o/255)/(a/255))},Xn=function(a,o){return a===255?255:(a=255*(o/255)/(1-a/255),a>255?255:a)};R.normal=O(F(G)),R.multiply=O(F(Me)),R.screen=O(F(qn)),R.overlay=O(F(Fn)),R.darken=O(F(je)),R.lighten=O(F(rt)),R.dodge=O(F(Xn)),R.burn=O(F(Wn));var _n=Math.pow,Vn=Math.sin,Yn=Math.cos;function Un(a,o,u,p,S){a===void 0&&(a=300),o===void 0&&(o=-1.5),u===void 0&&(u=1),p===void 0&&(p=1),S===void 0&&(S=[0,1]);var C=0,w;l(S)==="array"?w=S[1]-S[0]:(w=0,S=[S,S]);var E=function(T){var P=c*((a+120)/360+o*T),D=_n(S[0]+w*T,p),W=C!==0?u[0]+T*C:u,z=W*D*(1-D)/2,_=Yn(P),X=Vn(P),re=D+z*(-.14861*_+1.78277*X),ae=D+z*(-.29227*_-.90649*X),oe=D+z*(1.97294*_);return B(e([re*255,ae*255,oe*255,1]))};return E.start=function(T){return T==null?a:(a=T,E)},E.rotations=function(T){return T==null?o:(o=T,E)},E.gamma=function(T){return T==null?p:(p=T,E)},E.hue=function(T){return T==null?u:(u=T,l(u)==="array"?(C=u[1]-u[0],C===0&&(u=u[1])):C=0,E)},E.lightness=function(T){return T==null?S:(l(T)==="array"?(S=T,w=T[1]-T[0]):(S=[T,T],w=0),E)},E.scale=function(){return B.scale(E)},E.hue(u),E}var Gn="0123456789abcdef",Zn=Math.floor,Kn=Math.random;function Jn(){for(var a="#",o=0;o<6;o++)a+=Gn.charAt(Zn(Kn()*16));return new A(a,"hex")}var Oi=Math.log,Qn=Math.pow,jn=Math.floor,es=Math.abs;function Di(a,o){o===void 0&&(o=null);var u={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return l(a)==="object"&&(a=Object.values(a)),a.forEach(function(p){o&&l(p)==="object"&&(p=p[o]),p!=null&&!isNaN(p)&&(u.values.push(p),u.sum+=p,p<u.min&&(u.min=p),p>u.max&&(u.max=p),u.count+=1)}),u.domain=[u.min,u.max],u.limits=function(p,S){return $i(u,p,S)},u}function $i(a,o,u){o===void 0&&(o="equal"),u===void 0&&(u=7),l(a)=="array"&&(a=Di(a));var p=a.min,S=a.max,C=a.values.sort(function(Gr,Zr){return Gr-Zr});if(u===1)return[p,S];var w=[];if(o.substr(0,1)==="c"&&(w.push(p),w.push(S)),o.substr(0,1)==="e"){w.push(p);for(var E=1;E<u;E++)w.push(p+E/u*(S-p));w.push(S)}else if(o.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");var T=Math.LOG10E*Oi(p),P=Math.LOG10E*Oi(S);w.push(p);for(var D=1;D<u;D++)w.push(Qn(10,T+D/u*(P-T)));w.push(S)}else if(o.substr(0,1)==="q"){w.push(p);for(var W=1;W<u;W++){var z=(C.length-1)*W/u,_=jn(z);if(_===z)w.push(C[_]);else{var X=z-_;w.push(C[_]*(1-X)+C[_+1]*X)}}w.push(S)}else if(o.substr(0,1)==="k"){var re,ae=C.length,oe=new Array(ae),ge=new Array(u),Oe=!0,Pe=0,Ye=null;Ye=[],Ye.push(p);for(var le=1;le<u;le++)Ye.push(p+le/u*(S-p));for(Ye.push(S);Oe;){for(var q=0;q<u;q++)ge[q]=0;for(var Z=0;Z<ae;Z++)for(var se=C[Z],ie=Number.MAX_VALUE,De=void 0,be=0;be<u;be++){var he=es(Ye[be]-se);he<ie&&(ie=he,De=be),ge[De]++,oe[Z]=De}for(var ce=new Array(u),de=0;de<u;de++)ce[de]=null;for(var pe=0;pe<ae;pe++)re=oe[pe],ce[re]===null?ce[re]=C[pe]:ce[re]+=C[pe];for(var it=0;it<u;it++)ce[it]*=1/ge[it];Oe=!1;for(var wt=0;wt<u;wt++)if(ce[wt]!==Ye[wt]){Oe=!0;break}Ye=ce,Pe++,Pe>200&&(Oe=!1)}for(var yt={},Xt=0;Xt<u;Xt++)yt[Xt]=[];for(var _t=0;_t<ae;_t++)re=oe[_t],yt[re].push(C[_t]);for(var dt=[],Mt=0;Mt<u;Mt++)dt.push(yt[Mt][0]),dt.push(yt[Mt][yt[Mt].length-1]);dt=dt.sort(function(Gr,Zr){return Gr-Zr}),w.push(dt[0]);for(var sr=1;sr<dt.length;sr+=2){var Bt=dt[sr];!isNaN(Bt)&&w.indexOf(Bt)===-1&&w.push(Bt)}}return w}function ts(a,o){a=new A(a),o=new A(o);var u=a.luminance(),p=o.luminance();return u>p?(u+.05)/(p+.05):(p+.05)/(u+.05)}var ct=Math.sqrt,Re=Math.pow,rs=Math.min,is=Math.max,Hi=Math.atan2,zi=Math.abs,Sr=Math.cos,qi=Math.sin,ns=Math.exp,Fi=Math.PI;function ss(a,o,u,p,S){u===void 0&&(u=1),p===void 0&&(p=1),S===void 0&&(S=1);var C=function(Bt){return 360*Bt/(2*Fi)},w=function(Bt){return 2*Fi*Bt/360};a=new A(a),o=new A(o);var E=Array.from(a.lab()),T=E[0],P=E[1],D=E[2],W=Array.from(o.lab()),z=W[0],_=W[1],X=W[2],re=(T+z)/2,ae=ct(Re(P,2)+Re(D,2)),oe=ct(Re(_,2)+Re(X,2)),ge=(ae+oe)/2,Oe=.5*(1-ct(Re(ge,7)/(Re(ge,7)+Re(25,7)))),Pe=P*(1+Oe),Ye=_*(1+Oe),le=ct(Re(Pe,2)+Re(D,2)),q=ct(Re(Ye,2)+Re(X,2)),Z=(le+q)/2,se=C(Hi(D,Pe)),ie=C(Hi(X,Ye)),De=se>=0?se:se+360,be=ie>=0?ie:ie+360,he=zi(De-be)>180?(De+be+360)/2:(De+be)/2,ce=1-.17*Sr(w(he-30))+.24*Sr(w(2*he))+.32*Sr(w(3*he+6))-.2*Sr(w(4*he-63)),de=be-De;de=zi(de)<=180?de:be<=De?de+360:de-360,de=2*ct(le*q)*qi(w(de)/2);var pe=z-T,it=q-le,wt=1+.015*Re(re-50,2)/ct(20+Re(re-50,2)),yt=1+.045*Z,Xt=1+.015*Z*ce,_t=30*ns(-Re((he-275)/25,2)),dt=2*ct(Re(Z,7)/(Re(Z,7)+Re(25,7))),Mt=-dt*qi(2*w(_t)),sr=ct(Re(pe/(u*wt),2)+Re(it/(p*yt),2)+Re(de/(S*Xt),2)+Mt*(it/(p*yt))*(de/(S*Xt)));return is(0,rs(100,sr))}function as(a,o,u){u===void 0&&(u="lab"),a=new A(a),o=new A(o);var p=a.get(u),S=o.get(u),C=0;for(var w in p){var E=(p[w]||0)-(S[w]||0);C+=E*E}return Math.sqrt(C)}function ls(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];try{return new(Function.prototype.bind.apply(A,[null].concat(a))),!0}catch(u){return!1}}for(var os={cool:function(){return Wt([B.hsl(180,1,.9),B.hsl(250,.7,.4)])},hot:function(){return Wt(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Ar={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Ur=0,Wi=Object.keys(Ar);Ur<Wi.length;Ur+=1){var Xi=Wi[Ur];Ar[Xi.toLowerCase()]=Ar[Xi]}return Object.assign(B,{average:Xr,bezier:I,blend:R,cubehelix:Un,mix:$e,interpolate:$e,random:Jn,scale:Wt,analyze:Di,contrast:ts,deltaE:ss,distance:as,limits:$i,valid:ls,scales:os,input:L,colors:vt,brewer:Ar}),B})});var wi=ve((Ea,yn)=>{var wn=st(),Rs=mn(),Es=bn(),bi=class{constructor(e,t,r,i,s=.3,l=0,n=null,f=1,h=!1){this.points=e,this.weights=t,this.width=r,this.height=i,this.sigma=s,this.interval=l,this.opacity=f,this.normalized=h,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,t){this.points=[],e.forEach(r=>{this.points.push(new wn(r[0],r[1]))}),this.weights=[],t.forEach(r=>{this.weights.push(r)})}draw(){let e=[];for(let s=0;s<this.width;s++){let l=[];for(let n=0;n<this.height;n++)l.push(0);e.push(l)}let t=1/(2*this.sigma**2);for(let s=0;s<this.points.length;s++){let l=this.points[s],n=this.weights[s];for(let f=0;f<this.width;f++)for(let h=0;h<this.height;h++){let d=((f-l.x)**2+(h-l.y)**2)*t,g=n*Math.exp(-d);e[f][h]+=g}}let r=1;if(!this.normalized){let s=-Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let f=0;f<this.height;f++)e[n][f]<l&&(l=e[n][f]),e[n][f]>s&&(s=e[n][f]);r=Math.max(Math.abs(l),Math.abs(s))}let i=Es.scale(this.colormap).domain([-1,1]);for(let s=0;s<this.width;s++)for(let l=0;l<this.height;l++){this.normalized||(e[s][l]=e[s][l]/r),this.interval!==0&&(e[s][l]=Math.round(e[s][l]/this.interval)*this.interval);let[n,f,h]=i(e[s][l]).rgb();this.setPixel(new wn(s,l),n,f,h)}}getImage(e){let t=new Image;t.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(t,0,0,this.width,this.height),e&&e(t)},t.onerror=function(r){console.log(r)},t.src=this.canvas.toDataURL()}getSVG(){return Rs(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,t,r,i){this.context.fillStyle="rgba("+t+","+r+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};yn.exports=bi});var hr=ve((La,An)=>{var Sn=Vt(),Ts=lr(),Ls=dn(),Ta=xr(),Fe=or(),Ms=Lr(),Bs=Nr(),Te=st(),Ps=wi(),yi=class{constructor(e,t=!0){this.preprocessor=new Ls(e),this.opts=this.preprocessor.opts,this.clear=t,this.svgWrapper=null}draw(e,t,r="light",i=null,s=!1,l=[],n=!1){t===null||t==="svg"?(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttributeNS(null,"width",this.opts.width),t.setAttributeNS(null,"height",this.opts.height)):t instanceof String&&(t=document.getElementById(t));let f={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let h=this.preprocessor;return h.initDraw(e,r,s,l),s||(this.themeManager=new Bs(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Ms(this.themeManager,t,this.opts,this.clear))),h.processGraph(),this.svgWrapper.determineDimensions(h.graph.vertices),this.drawAtomHighlights(h.opts.debug),this.drawEdges(h.opts.debug),this.drawVertices(h.opts.debug),i!==null&&this.drawWeights(i,n),h.opts.debug&&(console.log(h.graph),console.log(h.rings),console.log(h.ringConnections)),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=f.padding,this.opts.compactDrawing=f.padding),t}drawCanvas(e,t,r="light",i=!1){let s=null;typeof t=="string"||t instanceof String?s=document.getElementById(t):s=t;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(null,"viewBox","0 0 500 500"),l.setAttributeNS(null,"width","500"),l.setAttributeNS(null,"height","500"),l.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(l),this.svgDrawer.draw(e,l,r,i),this.svgDrawer.svgWrapper.toCanvas(s,this.svgDrawer.opts.width,this.svgDrawer.opts.height),document.body.removeChild(l),t}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let t=this.preprocessor,r=t.graph,i=t.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),r.traverseBF(0,n=>{let f=r.getEdges(n.id);for(var h=0;h<f.length;h++){let d=f[h];s[d]||(s[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var l=0;l<i.length;l++){let n=i[l];t.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,t){let r=this.preprocessor,i=r.opts,s=this.svgWrapper,l=r.graph.edges[e],n=r.graph.vertices[l.sourceId],f=r.graph.vertices[l.targetId],h=n.value.element,d=f.value.element;if((!n.value.isDrawn||!f.value.isDrawn)&&r.opts.atomVisualization==="default")return;let g=n.position,c=f.position,b=r.getEdgeNormals(l),x=Sn.clone(b);if(x[0].multiplyScalar(10).add(g),x[1].multiplyScalar(10).add(g),l.bondType==="="||r.getRingbondType(n,f)==="="||l.isPartOfAromaticRing&&r.bridgedRing){let y=r.areVerticesInSameRing(n,f),L=r.chooseSide(n,f,x);if(y){let H=r.getLargestOrAromaticCommonRing(n,f).center;b[0].multiplyScalar(i.bondSpacing),b[1].multiplyScalar(i.bondSpacing);let B=null;H.sameSideAs(n.position,f.position,Te.add(g,b[0]))?B=new Fe(Te.add(g,b[0]),Te.add(c,b[0]),h,d):B=new Fe(Te.add(g,b[1]),Te.add(c,b[1]),h,d),B.shorten(i.bondLength-i.shortBondLength*i.bondLength),l.isPartOfAromaticRing?s.drawLine(B,!0):s.drawLine(B),s.drawLine(new Fe(g,c,h,d))}else if(l.center||n.isTerminal()&&f.isTerminal()||L.anCount==0&&L.bnCount>1||L.bnCount==0&&L.anCount>1){this.multiplyNormals(b,i.halfBondSpacing);let A=new Fe(Te.add(g,b[0]),Te.add(c,b[0]),h,d),H=new Fe(Te.add(g,b[1]),Te.add(c,b[1]),h,d);s.drawLine(A),s.drawLine(H)}else if(L.sideCount[0]>L.sideCount[1]||L.totalSideCount[0]>L.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let A=new Fe(Te.add(g,b[0]),Te.add(c,b[0]),h,d);A.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(A),s.drawLine(new Fe(g,c,h,d))}else if(L.sideCount[0]<L.sideCount[1]||L.totalSideCount[0]<=L.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let A=new Fe(Te.add(g,b[1]),Te.add(c,b[1]),h,d);A.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(A),s.drawLine(new Fe(g,c,h,d))}}else if(l.bondType==="#"){b[0].multiplyScalar(i.bondSpacing/1.5),b[1].multiplyScalar(i.bondSpacing/1.5);let y=new Fe(Te.add(g,b[0]),Te.add(c,b[0]),h,d),L=new Fe(Te.add(g,b[1]),Te.add(c,b[1]),h,d);s.drawLine(y),s.drawLine(L),s.drawLine(new Fe(g,c,h,d))}else if(l.bondType!=="."){let y=n.value.isStereoCenter,L=f.value.isStereoCenter;l.wedge==="up"?s.drawWedge(new Fe(g,c,h,d,y,L)):l.wedge==="down"?s.drawDashedWedge(new Fe(g,c,h,d,y,L)):s.drawLine(new Fe(g,c,h,d,y,L))}if(t){let y=Te.midpoint(g,c);s.drawDebugText(y.x,y.y,"e: "+e)}}drawAtomHighlights(e){let t=this.preprocessor,r=t.opts,i=t.graph,s=t.rings,l=this.svgWrapper;for(var n=0;n<i.vertices.length;n++){let h=i.vertices[n],d=h.value;for(var f=0;f<t.highlight_atoms.length;f++){let g=t.highlight_atoms[f];d.class===g[0]&&l.drawAtomHighlight(h.position.x,h.position.y,g[1])}}}drawVertices(e){let t=this.preprocessor,r=t.opts,i=t.graph,s=t.rings,l=this.svgWrapper;for(var n=i.vertices.length,n=0;n<i.vertices.length;n++){let h=i.vertices[n],d=h.value,g=0,c=0,b=h.value.bondCount,x=d.element,y=Ts.maxBonds[x]-b,L=h.getTextDirection(i.vertices,d.hasAttachedPseudoElements),A=r.terminalCarbons||x!=="C"||d.hasAttachedPseudoElements?h.isTerminal():!1,H=d.element==="C";if(d.element==="N"&&d.isPartOfAromaticRing&&(y=0),d.bracket&&(y=d.bracket.hcount,g=d.bracket.charge,c=d.bracket.isotope),(g||c||i.vertices.length<3)&&(H=!1),r.atomVisualization==="allballs")l.drawBall(h.position.x,h.position.y,x);else if(d.isDrawn&&(!H||d.drawExplicit||A||d.hasAttachedPseudoElements)||i.vertices.length===1)if(r.atomVisualization==="default"){let B=d.getAttachedPseudoElements();d.hasAttachedPseudoElements&&i.vertices.length===Object.keys(B).length+1&&(L="right"),l.drawText(h.position.x,h.position.y,x,y,L,A,g,c,i.vertices.length,B)}else r.atomVisualization==="balls"&&l.drawBall(h.position.x,h.position.y,x);else if(h.getNeighbourCount()===2&&h.forcePositioned==!0){let B=i.vertices[h.neighbours[0]].position,k=i.vertices[h.neighbours[1]].position,$=Te.threePointangle(h.position,B,k);Math.abs(Math.PI-$)<.1&&l.drawPoint(h.position.x,h.position.y,x)}if(e){let B="v: "+h.id+" "+Sn.print(d.ringbonds);l.drawDebugText(h.position.x,h.position.y,B)}}if(r.debug)for(var n=0;n<s.length;n++){let h=s[n].center;l.drawDebugPoint(h.x,h.y,"r: "+s[n].id)}}drawWeights(e,t){if(!e||e.every(s=>s===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(let s of this.preprocessor.graph.atomIdxToVertexId){let l=this.preprocessor.graph.vertices[s];r.push(new Te(l.position.x-this.svgWrapper.minX,l.position.y-this.svgWrapper.minY))}let i=new Ps(r,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,t);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}};An.exports=yi});var Ai=ve((Ma,Cn)=>{var Is=hr(),Si=class{constructor(e){this.svgDrawer=new Is(e)}draw(e,t,r="light",i=!1,s=[]){let l=null;typeof t=="string"||t instanceof String?l=document.getElementById(t):l=t;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),n.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),n.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,n,r,null,i,s),this.svgDrawer.svgWrapper.toCanvas(l,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){this.svgDrawer.getMolecularFormula()}};Cn.exports=Si});var Mr=ve((Ba,xn)=>{xn.exports=function(){"use strict";function M(r,i){function s(){this.constructor=r}s.prototype=i.prototype,r.prototype=new s}function e(r,i,s,l){this.message=r,this.expected=i,this.found=s,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}M(e,Error),e.buildMessage=function(r,i){var s={literal:function(c){return'"'+n(c.text)+'"'},class:function(c){var b="",x;for(x=0;x<c.parts.length;x++)b+=c.parts[x]instanceof Array?f(c.parts[x][0])+"-"+f(c.parts[x][1]):f(c.parts[x]);return"["+(c.inverted?"^":"")+b+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};function l(c){return c.charCodeAt(0).toString(16).toUpperCase()}function n(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}function f(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}function h(c){return s[c.type](c)}function d(c){var b=new Array(c.length),x,y;for(x=0;x<c.length;x++)b[x]=h(c[x]);if(b.sort(),b.length>0){for(x=1,y=1;x<b.length;x++)b[x-1]!==b[x]&&(b[y]=b[x],y++);b.length=y}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function g(c){return c?'"'+n(c)+'"':"end of input"}return"Expected "+d(r)+" but "+g(i)+" found."};function t(r,i){i=i!==void 0?i:{};var s=r.split("(").length-1,l=r.split(")").length-1;if(s!==l)throw $t("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},f={chain:Ht},h=Ht,d=function(N){for(var v=[],I=[],R=0;R<N[1].length;R++)v.push(N[1][R]);for(var R=0;R<N[2].length;R++){var O=N[2][R][0]?N[2][R][0]:"-";I.push({bond:O,id:N[2][R][1]})}for(var R=0;R<N[3].length;R++)v.push(N[3][R]);for(var R=0;R<N[6].length;R++)v.push(N[6][R]);return{atom:N[0],isBracket:!!N[0].element,branches:v,branchCount:v.length,ringbonds:I,ringbondCount:I.length,bond:N[4]?N[4]:"-",next:N[5],hasNext:!!N[5]}},g="(",c=te("(",!1),b=")",x=te(")",!1),y=function(N){var v=N[1]?N[1]:"-";return N[2].branchBond=v,N[2]},L=function(N){return N},A=/^[\-=#$:\/\\.]/,H=$e(["-","=","#","$",":","/","\\","."],!1,!1),B=function(N){return N},k="[",$=te("[",!1),J="se",Q=te("se",!1),ue="as",ne=te("as",!1),j="]",ee=te("]",!1),me=function(N){return{isotope:N[1],element:N[2],chirality:N[3],hcount:N[4],charge:N[5],class:N[6]}},fe="B",xe=te("B",!1),We="r",He=te("r",!1),Ke="C",Je=te("C",!1),lt="l",Ae=te("l",!1),Se=/^[NOPSFI]/,St=$e(["N","O","P","S","F","I"],!1,!1),At=function(N){return N.length>1?N.join(""):N},Ct=/^[bcnops]/,It=$e(["b","c","n","o","p","s"],!1,!1),xt="*",U=te("*",!1),Ne=function(N){return N},Qe=/^[A-Z]/,Be=$e([["A","Z"]],!1,!1),et=/^[a-z]/,Ge=$e([["a","z"]],!1,!1),Xe=function(N){return N.join("")},_e="%",Nt=te("%",!1),Ze=/^[1-9]/,Ie=$e([["1","9"]],!1,!1),Le=/^[0-9]/,ke=$e([["0","9"]],!1,!1),ot=function(N){return N.length==1?Number(N):Number(N.join("").replace("%",""))},ye="@",Rt=te("@",!1),pt="TH",ht=te("TH",!1),nt=/^[12]/,tt=$e(["1","2"],!1,!1),ut="AL",gt=te("AL",!1),ft="SP",Et=te("SP",!1),Br=/^[1-3]/,Pr=$e([["1","3"]],!1,!1),Kt="TB",ur=te("TB",!1),gr="OH",Ir=te("OH",!1),kr=function(N){return N[1]?N[1]=="@"?"@@":N[1].join("").replace(",",""):"@"},Or=function(N){return N},Jt="+",Qt=te("+",!1),vt=function(N){return N[1]?N[1]!="+"?Number(N[1].join("")):2:1},fr="-",cr=te("-",!1),dr=function(N){return N[1]?N[1]!="-"?-Number(N[1].join("")):-2:-1},kt="H",pr=te("H",!1),Dr=function(N){return N[1]?Number(N[1]):1},$r=":",Ot=te(":",!1),Hr=/^[0]/,vr=$e(["0"],!1,!1),jt=function(N){return Number(N[1][0]+N[1][1].join(""))},er=function(N){return Number(N.join(""))},m=0,we=0,Tt=[{line:1,column:1}],Ve=0,tr=[],Y=0,Dt;if("startRule"in i){if(!(i.startRule in f))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');h=f[i.startRule]}function Bi(){return r.substring(we,m)}function Pi(){return Lt(we,m)}function Ii(N,v){throw v=v!==void 0?v:Lt(we,m),wr([mt(N)],r.substring(we,m),v)}function mr(N,v){throw v=v!==void 0?v:Lt(we,m),$t(N,v)}function te(N,v){return{type:"literal",text:N,ignoreCase:v}}function $e(N,v,I){return{type:"class",parts:N,inverted:v,ignoreCase:I}}function ki(){return{type:"any"}}function rr(){return{type:"end"}}function mt(N){return{type:"other",description:N}}function br(N){var v=Tt[N],I;if(v)return v;for(I=N-1;!Tt[I];)I--;for(v=Tt[I],v={line:v.line,column:v.column};I<N;)r.charCodeAt(I)===10?(v.line++,v.column=1):v.column++,I++;return Tt[N]=v,v}function Lt(N,v){var I=br(N),R=br(v);return{start:{offset:N,line:I.line,column:I.column},end:{offset:v,line:R.line,column:R.column}}}function V(N){m<Ve||(m>Ve&&(Ve=m,tr=[]),tr.push(N))}function $t(N,v){return new e(N,null,null,v)}function wr(N,v,I){return new e(e.buildMessage(N,v),N,v,I)}function Ht(){var N,v,I,R,O,F,G,Me,je,rt;if(N=m,v=m,I=zr(),I!==n){for(R=[],O=bt();O!==n;)R.push(O),O=bt();if(R!==n){for(O=[],F=m,G=zt(),G===n&&(G=null),G!==n?(Me=nr(),Me!==n?(G=[G,Me],F=G):(m=F,F=n)):(m=F,F=n);F!==n;)O.push(F),F=m,G=zt(),G===n&&(G=null),G!==n?(Me=nr(),Me!==n?(G=[G,Me],F=G):(m=F,F=n)):(m=F,F=n);if(O!==n){for(F=[],G=bt();G!==n;)F.push(G),G=bt();if(F!==n)if(G=zt(),G===n&&(G=null),G!==n)if(Me=Ht(),Me===n&&(Me=null),Me!==n){for(je=[],rt=bt();rt!==n;)je.push(rt),rt=bt();je!==n?(I=[I,R,O,F,G,Me,je],v=I):(m=v,v=n)}else m=v,v=n;else m=v,v=n;else m=v,v=n}else m=v,v=n}else m=v,v=n}else m=v,v=n;return v!==n&&(we=N,v=d(v)),N=v,N}function bt(){var N,v,I,R,O,F;return N=m,v=m,r.charCodeAt(m)===40?(I=g,m++):(I=n,Y===0&&V(c)),I!==n?(R=zt(),R===n&&(R=null),R!==n?(O=Ht(),O!==n?(r.charCodeAt(m)===41?(F=b,m++):(F=n,Y===0&&V(x)),F!==n?(I=[I,R,O,F],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=y(v)),N=v,N}function zr(){var N,v;return N=m,v=Fr(),v===n&&(v=qt(),v===n&&(v=qr(),v===n&&(v=Ft()))),v!==n&&(we=N,v=L(v)),N=v,N}function zt(){var N,v;if(N=m,A.test(r.charAt(m))){if(v=r.charAt(m),v===r.charAt(m+1)&&(v=n,Y===0))throw $t("The parser encountered a bond repetition.",m+1);m++}else v=n,Y===0&&V(H);return v!==n&&(we=N,v=B(v)),N=v,N}function qr(){var N,v,I,R,O,F,G,Me,je,rt;return N=m,v=m,r.charCodeAt(m)===91?(I=k,m++):(I=n,Y===0&&V($)),I!==n?(R=Yr(),R===n&&(R=null),R!==n?(r.substr(m,2)===J?(O=J,m+=2):(O=n,Y===0&&V(Q)),O===n&&(r.substr(m,2)===ue?(O=ue,m+=2):(O=n,Y===0&&V(ne)),O===n&&(O=qt(),O===n&&(O=ir(),O===n&&(O=Ft())))),O!==n?(F=yr(),F===n&&(F=null),F!==n?(G=Vr(),G===n&&(G=null),G!==n?(Me=Wr(),Me===n&&(Me=null),Me!==n?(je=Wt(),je===n&&(je=null),je!==n?(r.charCodeAt(m)===93?(rt=j,m++):(rt=n,Y===0&&V(ee)),rt!==n?(I=[I,R,O,F,G,Me,je,rt],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=me(v)),N=v,N}function Fr(){var N,v,I,R;return N=m,v=m,r.charCodeAt(m)===66?(I=fe,m++):(I=n,Y===0&&V(xe)),I!==n?(r.charCodeAt(m)===114?(R=We,m++):(R=n,Y===0&&V(He)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v===n&&(v=m,r.charCodeAt(m)===67?(I=Ke,m++):(I=n,Y===0&&V(Je)),I!==n?(r.charCodeAt(m)===108?(R=lt,m++):(R=n,Y===0&&V(Ae)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v===n&&(Se.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,Y===0&&V(St)))),v!==n&&(we=N,v=At(v)),N=v,N}function qt(){var N,v;return N=m,Ct.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,Y===0&&V(It)),v!==n&&(we=N,v=L(v)),N=v,N}function Ft(){var N,v;return N=m,r.charCodeAt(m)===42?(v=xt,m++):(v=n,Y===0&&V(U)),v!==n&&(we=N,v=Ne(v)),N=v,N}function ir(){var N,v,I,R;return N=m,v=m,Qe.test(r.charAt(m))?(I=r.charAt(m),m++):(I=n,Y===0&&V(Be)),I!==n?(et.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,Y===0&&V(Ge)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=Xe(v)),N=v,N}function nr(){var N,v,I,R,O;return N=m,v=m,r.charCodeAt(m)===37?(I=_e,m++):(I=n,Y===0&&V(Nt)),I!==n?(Ze.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,Y===0&&V(Ie)),R!==n?(Le.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,Y===0&&V(ke)),O!==n?(I=[I,R,O],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v===n&&(Le.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,Y===0&&V(ke))),v!==n&&(we=N,v=ot(v)),N=v,N}function yr(){var N,v,I,R,O,F,G;return N=m,v=m,r.charCodeAt(m)===64?(I=ye,m++):(I=n,Y===0&&V(Rt)),I!==n?(r.charCodeAt(m)===64?(R=ye,m++):(R=n,Y===0&&V(Rt)),R===n&&(R=m,r.substr(m,2)===pt?(O=pt,m+=2):(O=n,Y===0&&V(ht)),O!==n?(nt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(tt)),F!==n?(O=[O,F],R=O):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===ut?(O=ut,m+=2):(O=n,Y===0&&V(gt)),O!==n?(nt.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(tt)),F!==n?(O=[O,F],R=O):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===ft?(O=ft,m+=2):(O=n,Y===0&&V(Et)),O!==n?(Br.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(Pr)),F!==n?(O=[O,F],R=O):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===Kt?(O=Kt,m+=2):(O=n,Y===0&&V(ur)),O!==n?(Ze.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(Ie)),F!==n?(Le.test(r.charAt(m))?(G=r.charAt(m),m++):(G=n,Y===0&&V(ke)),G===n&&(G=null),G!==n?(O=[O,F,G],R=O):(m=R,R=n)):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===gr?(O=gr,m+=2):(O=n,Y===0&&V(Ir)),O!==n?(Ze.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(Ie)),F!==n?(Le.test(r.charAt(m))?(G=r.charAt(m),m++):(G=n,Y===0&&V(ke)),G===n&&(G=null),G!==n?(O=[O,F,G],R=O):(m=R,R=n)):(m=R,R=n)):(m=R,R=n)))))),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=kr(v)),N=v,N}function Wr(){var N,v;return N=m,v=Xr(),v===n&&(v=_r()),v!==n&&(we=N,v=Or(v)),N=v,N}function Xr(){var N,v,I,R,O,F;return N=m,v=m,r.charCodeAt(m)===43?(I=Jt,m++):(I=n,Y===0&&V(Qt)),I!==n?(r.charCodeAt(m)===43?(R=Jt,m++):(R=n,Y===0&&V(Qt)),R===n&&(R=m,Ze.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,Y===0&&V(Ie)),O!==n?(Le.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(ke)),F===n&&(F=null),F!==n?(O=[O,F],R=O):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=vt(v)),N=v,N}function _r(){var N,v,I,R,O,F;return N=m,v=m,r.charCodeAt(m)===45?(I=fr,m++):(I=n,Y===0&&V(cr)),I!==n?(r.charCodeAt(m)===45?(R=fr,m++):(R=n,Y===0&&V(cr)),R===n&&(R=m,Ze.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,Y===0&&V(Ie)),O!==n?(Le.test(r.charAt(m))?(F=r.charAt(m),m++):(F=n,Y===0&&V(ke)),F===n&&(F=null),F!==n?(O=[O,F],R=O):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=dr(v)),N=v,N}function Vr(){var N,v,I,R;return N=m,v=m,r.charCodeAt(m)===72?(I=kt,m++):(I=n,Y===0&&V(pr)),I!==n?(Le.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,Y===0&&V(ke)),R===n&&(R=null),R!==n?(I=[I,R],v=I):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=Dr(v)),N=v,N}function Wt(){var N,v,I,R,O,F,G;if(N=m,v=m,r.charCodeAt(m)===58?(I=$r,m++):(I=n,Y===0&&V(Ot)),I!==n){if(R=m,Ze.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,Y===0&&V(Ie)),O!==n){for(F=[],Le.test(r.charAt(m))?(G=r.charAt(m),m++):(G=n,Y===0&&V(ke));G!==n;)F.push(G),Le.test(r.charAt(m))?(G=r.charAt(m),m++):(G=n,Y===0&&V(ke));F!==n?(O=[O,F],R=O):(m=R,R=n)}else m=R,R=n;R===n&&(Hr.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,Y===0&&V(vr))),R!==n?(I=[I,R],v=I):(m=v,v=n)}else m=v,v=n;return v!==n&&(we=N,v=jt(v)),N=v,N}function Yr(){var N,v,I,R,O;return N=m,v=m,Ze.test(r.charAt(m))?(I=r.charAt(m),m++):(I=n,Y===0&&V(Ie)),I!==n?(Le.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,Y===0&&V(ke)),R===n&&(R=null),R!==n?(Le.test(r.charAt(m))?(O=r.charAt(m),m++):(O=n,Y===0&&V(ke)),O===n&&(O=null),O!==n?(I=[I,R,O],v=I):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(we=N,v=er(v)),N=v,N}if(Dt=h(),Dt!==n&&m===r.length)return Dt;throw Dt!==n&&m<r.length&&V(rr()),wr(tr,Ve<r.length?r.charAt(Ve):null,Ve<r.length?Lt(Ve,Ve+1):Lt(Ve,Ve))}return{SyntaxError:e,parse:t}}()});var Rn=ve((Pa,Nn)=>{var Ci=Mr(),xi=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let t=e.split(">");if(t.length!==3)throw new Error("Invalid reaction SMILES. Did you add fewer than or more than two '>'?");t[0]!==""&&(this.reactantsSmiles=t[0].split(".")),t[1]!==""&&(this.reagentsSmiles=t[1].split(".")),t[2]!==""&&(this.productsSmiles=t[2].split("."));for(var r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(Ci.parse(this.reactantsSmiles[r]));for(var r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(Ci.parse(this.reagentsSmiles[r]));for(var r=0;r<this.productsSmiles.length;r++)this.products.push(Ci.parse(this.productsSmiles[r]))}};Nn.exports=xi});var Ri=ve((Ia,En)=>{var ks=Rn(),Ni=class{static parse(e){return new ks(e)}};En.exports=Ni});var Ln=ve((ka,Tn)=>{var Os={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};Tn.exports=Os});var Li=ve((Oa,Bn)=>{var Ds=hr(),Ei=Lr(),$s=Rr(),Hs=Nr(),Mn=Ln(),Ti=class{constructor(e,t){this.defaultOptions={scale:t.scale>0?t.scale:1,fontSize:t.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:t.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=$s.extend(!0,this.defaultOptions,e),this.drawer=new Ds(t),this.molOpts=this.drawer.opts}draw(e,t,r="light",i=null,s="{reagents}",l="",n=!1){if(this.themeManager=new Hs(this.molOpts.themes,r),this.opts.weights.normalize){let A=-Number.MAX_SAFE_INTEGER,H=Number.MAX_SAFE_INTEGER;if(i.hasOwnProperty("reactants"))for(let k=0;k<i.reactants.length;k++)for(let $=0;$<i.reactants[k].length;$++)i.reactants[k][$]<H&&(H=i.reactants[k][$]),i.reactants[k][$]>A&&(A=i.reactants[k][$]);if(i.hasOwnProperty("reagents"))for(let k=0;k<i.reagents.length;k++)for(let $=0;$<i.reagents[k].length;$++)i.reagents[k][$]<H&&(H=i.reagents[k][$]),i.reagents[k][$]>A&&(A=i.reagents[k][$]);if(i.hasOwnProperty("products"))for(let k=0;k<i.products.length;k++)for(let $=0;$<i.products[k].length;$++)i.products[k][$]<H&&(H=i.products[k][$]),i.products[k][$]>A&&(A=i.products[k][$]);let B=Math.max(Math.abs(H),Math.abs(A));if(B===0&&(B=1),i.hasOwnProperty("reactants"))for(let k=0;k<i.reactants.length;k++)for(let $=0;$<i.reactants[k].length;$++)i.reactants[k][$]/=B;if(i.hasOwnProperty("reagents"))for(let k=0;k<i.reagents.length;k++)for(let $=0;$<i.reagents[k].length;$++)i.reagents[k][$]/=B;if(i.hasOwnProperty("products"))for(let k=0;k<i.products.length;k++)for(let $=0;$<i.products[k].length;$++)i.products[k][$]/=B}let f=null;for(t===null||t==="svg"?(f=document.createElementNS("http://www.w3.org/2000/svg","svg"),f.setAttribute("xmlns","http://www.w3.org/2000/svg"),f.setAttributeNS(null,"width","500"),f.setAttributeNS(null,"height","500")):typeof t=="string"||t instanceof String?f=document.getElementById(t):f=t;f.firstChild;)f.removeChild(f.firstChild);let h=[],d=0;for(var g=0;g<e.reactants.length;g++){g>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let A=null;i&&i.hasOwnProperty("reactants")&&i.reactants.length>g&&(A=i.reactants[g]);let H=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[g],H,r,A,n,[],this.opts.weights.normalize);let B={width:H.viewBox.baseVal.width*this.opts.scale,height:H.viewBox.baseVal.height*this.opts.scale,svg:H};h.push(B),B.height>d&&(d=B.height)}h.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*2*this.opts.scale,svg:this.getArrow()});let c="";for(var g=0;g<e.reagents.length;g++){g>0&&(c+=", ");let H=this.drawer.getMolecularFormula(e.reagents[g]);H in Mn&&(H=Mn[H]),c+=Ei.replaceNumbersWithSubscript(H)}s=s.replace("{reagents}",c);let b=Ei.writeText(s,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale),x=(this.opts.arrow.length*this.opts.scale-b.width)/2;h.push({svg:b.svg,height:b.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+x,offsetY:-(b.height/2)-this.opts.arrow.margin,position:"relative"});let y=Ei.writeText(l,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);x=(this.opts.arrow.length*this.opts.scale-y.width)/2,h.push({svg:y.svg,height:y.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+x,offsetY:y.height/2+this.opts.arrow.margin,position:"relative"});for(var g=0;g<e.products.length;g++){g>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let H=null;i&&i.hasOwnProperty("products")&&i.products.length>g&&(H=i.products[g]);let B=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[g],B,r,H,n,[],this.opts.weights.normalize);let k={width:B.viewBox.baseVal.width*this.opts.scale,height:B.viewBox.baseVal.height*this.opts.scale,svg:B};h.push(k),k.height>d&&(d=k.height)}let L=0;return h.forEach(A=>{var k,$;let H=(k=A.offsetX)!=null?k:0,B=($=A.offsetY)!=null?$:0;A.svg.setAttributeNS(null,"x",Math.round(L+H)),A.svg.setAttributeNS(null,"y",Math.round((d-A.height)/2+B)),A.svg.setAttributeNS(null,"width",Math.round(A.width)),A.svg.setAttributeNS(null,"height",Math.round(A.height)),f.appendChild(A.svg),A.position!=="relative"&&(L+=Math.round(A.width+this.opts.spacing+H))}),f.setAttributeNS(null,"viewBox",`0 0 ${L} ${d}`),f.style.width=L+"px",f.style.height=d+"px",f}getPlus(){let e=this.opts.plus.size,t=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-t/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",t),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"x",e/2-t/2),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",e),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(i),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r}getArrowhead(){let e=this.opts.arrow.headSize,t=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",e),t.setAttributeNS(null,"markerHeight",e),t.setAttributeNS(null,"refX",0),t.setAttributeNS(null,"refY",e/2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),t.appendChild(r),t}getCDArrowhead(){let e=this.opts.arrow.headSize,t=e*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",t*2),r.setAttributeNS(null,"markerHeight",e*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(i),r}getArrow(){let e=this.opts.arrow.headSize,t=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),r.appendChild(i),r.setAttributeNS(null,"id","arrow"),s.setAttributeNS(null,"x1",0),s.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"x2",t),s.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 ${-e/2} ${t+e*(7/4.5)} ${e}`),r}};Bn.exports=Ti});var kn=ve(($a,In)=>{var Da=Ai(),zs=Mr(),qs=Ri(),Fs=hr(),Ws=Li(),Pn=Lr(),Xs=Rr(),Mi=class M{constructor(e={},t={}){this.drawer=new Fs(e),this.reactionDrawer=new Ws(t,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},t={},r="data-smiles",i="light",s=null,l=null){new M(e,t).apply(r,i,s,l)}apply(e="data-smiles",t="light",r=null,i=null){document.querySelectorAll(`[${e}]`).forEach(l=>{let n=l.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let f=t,h=null;if(l.hasAttribute("data-smiles-theme")&&(f=l.getAttribute("data-smiles-theme")),l.hasAttribute("data-smiles-weights")&&(h=l.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(l.hasAttribute("data-smiles-reactant-weights")||l.hasAttribute("data-smiles-reagent-weights")||l.hasAttribute("data-smiles-product-weights"))&&(h={reactants:[],reagents:[],products:[]},l.hasAttribute("data-smiles-reactant-weights")&&(h.reactants=l.getAttribute("data-smiles-reactant-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-reagent-weights")&&(h.reagents=l.getAttribute("data-smiles-reagent-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-product-weights")&&(h.products=l.getAttribute("data-smiles-product-weights").split(";").map(d=>d.split(",").map(parseFloat)))),l.hasAttribute("data-smiles-options")||l.hasAttribute("data-smiles-reaction-options")){let d={};l.hasAttribute("data-smiles-options")&&(d=JSON.parse(l.getAttribute("data-smiles-options").replaceAll("'",'"')));let g={};l.hasAttribute("data-smiles-reaction-options")&&(g=JSON.parse(l.getAttribute("data-smiles-reaction-options").replaceAll("'",'"'))),new M(d,g).draw(n,l,f,r,i,h)}else this.draw(n,l,f,r,i,h)})}draw(e,t,r="light",i=null,s=null,l=null){let n=[];[e,...n]=e.split(" ");let f=n.join(" "),h={};if(f.includes("__")){let g=f.substring(f.indexOf("__")+2,f.lastIndexOf("__"));h=JSON.parse(g.replaceAll("'",'"'))}let d={textAboveArrow:"{reagents}",textBelowArrow:""};if(h=Xs.extend(!0,d,h),e.includes(">"))try{this.drawReaction(e,t,r,h,l,i)}catch(g){s?s(g):console.error(g)}else try{this.drawMolecule(e,t,r,l,i)}catch(g){s?s(g):console.error(g)}}drawMolecule(e,t,r,i,s){let l=zs.parse(e);if(t===null||t==="svg"){let n=this.drawer.draw(l,null,r,i),f=this.getDimensions(n);n.setAttributeNS(null,"width",""+f.w),n.setAttributeNS(null,"height",""+f.h),s&&s(n)}else if(t==="canvas"){let n=this.svgToCanvas(this.drawer.draw(l,null,r,i));s&&s(n)}else if(t==="img"){let n=this.svgToImg(this.drawer.draw(l,null,r,i));s&&s(n)}else t instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(l,null,r,i),t),s&&s(t)):t instanceof SVGElement?(this.drawer.draw(l,t,r,i),s&&s(t)):document.querySelectorAll(t).forEach(f=>{let h=f.nodeName.toLowerCase();h==="svg"?(this.drawer.draw(l,f,r,i),s&&s(f)):h==="canvas"?(this.svgToCanvas(this.drawer.draw(l,null,r,i),f),s&&s(f)):h==="img"&&(this.svgToImg(this.drawer.draw(l,null,r,i),f),s&&s(f))})}drawReaction(e,t,r,i,s,l){let n=qs.parse(e);if(t===null||t==="svg"){let f=this.reactionDrawer.draw(n,null,r),h=this.getDimensions(f);f.setAttributeNS(null,"width",""+h.w),f.setAttributeNS(null,"height",""+h.h),l&&l(f)}else if(t==="canvas"){let f=this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));l&&l(f)}else if(t==="img"){let f=this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));l&&l(f)}else t instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),t),l&&l(t)):t instanceof SVGElement?(this.reactionDrawer.draw(n,t,r,s,i.textAboveArrow,i.textBelowArrow),l&&l(t)):document.querySelectorAll(t).forEach(h=>{let d=h.nodeName.toLowerCase();d==="svg"?(this.reactionDrawer.draw(n,h,r,s,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(h.style.width=null,h.style.height=null),l&&l(h)):d==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),h),l&&l(h)):d==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),h),l&&l(h))})}svgToCanvas(e,t=null){t===null&&(t=document.createElement("canvas"));let r=this.getDimensions(t,e);return Pn.svgToCanvas(e,t,r.w,r.h),t}svgToImg(e,t=null){t===null&&(t=document.createElement("img"));let r=this.getDimensions(t,e);return Pn.svgToImg(e,t,r.w,r.h),t}getDimensions(e,t=null){let r=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(r===null&&(r=e.width),i===null&&(i=e.height),e.style.width!==""&&(r=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):t&&(r=parseFloat(t.style.width),i=parseFloat(t.style.height)),{w:r,h:i}}};In.exports=Mi});var Gs=ve((Ha,zn)=>{var On=Ai(),Dn=Mr(),$n=Ri(),_s=hr(),Vs=Li(),Hn=kn(),Ys=wi(),Us=!!(typeof window!="undefined"&&window.document&&window.document.createElement),Ue={Version:"2.1.10"};Ue.Drawer=On;Ue.Parser=Dn;Ue.SvgDrawer=_s;Ue.ReactionDrawer=Vs;Ue.ReactionParser=$n;Ue.GaussDrawer=Ys;Ue.clean=function(M){return M.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")};Ue.apply=function(M,e="canvas[data-smiles]",t="light",r=null){let i=new On(M),s=document.querySelectorAll(e);for(var l=0;l<s.length;l++){let n=s[l];Ue.parse(n.getAttribute("data-smiles"),function(f){i.draw(f,n,t,!1)},function(f){r&&r(f)})}};Ue.parse=function(M,e,t){try{e&&e(Dn.parse(M))}catch(r){t&&t(r)}};Ue.parseReaction=function(M,e,t){try{e&&e($n.parse(M))}catch(r){t&&t(r)}};Us&&(window.SmilesDrawer=Ue,window.SmiDrawer=Hn);Ue.SmiDrawer=Hn;Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(M){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,r=arguments[1],i=r>>0,s=i<0?Math.max(t+i,0):Math.min(i,t),l=arguments[2],n=l===void 0?t:l>>0,f=n<0?Math.max(t+n,0):Math.min(n,t);s<f;)e[s]=M,s++;return e}});zn.exports=Ue});Gs();})();
/*! Bundled license information:

chroma-js/dist/chroma.cjs:
  (**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2024, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   *)
*/
//# sourceMappingURL=bundle.min.js.map
